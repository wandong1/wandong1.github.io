<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.102.3"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>万东的云计算运维博客</title><meta name=keywords content="Blog,Portfolio,PaperMod"><meta name=description content="ExampleSite description"><meta name=author content="Me"><link rel=canonical href=https://wandong1.github.io/><link crossorigin=anonymous href=/assets/css/stylesheet.min.77d563e104d7b39d673d4f21adf63da1ad0244dbcd78291ac2b44dc25b0066e1.css integrity="sha256-d9Vj4QTXs51nPU8hrfY9oa0CRNvNeCkawrRNwlsAZuE=" rel="preload stylesheet" as=style><link rel=icon href=https://wandong1.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://wandong1.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://wandong1.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://wandong1.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://wandong1.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://wandong1.github.io/index.xml><link rel=alternate type=application/json href=https://wandong1.github.io/index.json><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="万东的云计算运维博客"><meta property="og:description" content="ExampleSite description"><meta property="og:type" content="website"><meta property="og:url" content="https://wandong1.github.io/"><meta property="og:image" content="https://wandong1.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wandong1.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="万东的云计算运维博客"><meta name=twitter:description content="ExampleSite description"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"万东的云计算运维博客","url":"https://wandong1.github.io","description":"ExampleSite description","thumbnailUrl":"https://wandong1.github.io/%3Clink%20/%20abs%20url%3E","sameAs":["https://github.com/wandong1"]}</script></head><body class="list dark" id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wandong1.github.io accesskey=h title="万东的云计算运维博客 (Alt + H)"><img src=https://wandong1.github.io/img-icon.png alt=logo aria-label=logo height=35>万东的云计算运维博客</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://wandong1.github.io/categories/ title=分类><span>分类</span></a></li><li><a href=https://wandong1.github.io/tags/ title=标签><span>标签</span></a></li><li><a href=https://wandong1.github.io/archives/ title=归档><span>归档</span></a></li><li><a href=https://wandong1.github.io/search title=搜索><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-entry><header class=entry-header><h2>docker部署jenkins</h2></header><section class=entry-content><p>创建服务 docker volume create jenkins-data docker run -d --name jenkins -p 80:8080 -p 50000:50000 -v jenkins-data:/var/jenkins_home jenkins/jenkins 查看首次登录密钥 docker logs jenkins # 或者 cat /var/jenkins_home/secrets/initialAdminPassword 修改国内插件源 # 进入jenkins_home/updates目录 sed -i 's/http:\/\/updates.jenkins.ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g' default.json sed -i 's/http:\/\/www.google.com/https:\/\/www.baidu.com/g' default.json 管理Jenkins->系统配置–>管理插件–>分别搜索Git Parameter/Git/Pipeline/kubernetes/Config File Provider， 选中点击安装。
• Git：拉取代码
• Git Parameter：Git参数化构建
• Pipeline：流水线
• kubernetes：连接Kubernetes动态创建Slave代理
• Config File Provider：存储配置文件
• Extended Choice Parameter：扩展选择框参数，支持多选
pipeline { agent any stages { stage('pull code') { steps { git credentialsId: 'fd53dd28-a24f-48ce-b6a3-edaefef0c61a', url: 'https://github....</p></section><footer class=entry-footer>1 min&nbsp;·&nbsp;89 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to docker部署jenkins" href=https://wandong1.github.io/post/docker%E9%83%A8%E7%BD%B2jenkins/></a></article><article class=post-entry><header class=entry-header><h2>docker镜像制作</h2></header><section class=entry-content><p>六、Dockerfile定制容器镜像 Dockerfile常用指令 docker build构建镜像 Usage: docker build [OPTIONS] PATH | URL | -[flags]Options: -t, –tag list # 镜像名称 -f, –file string # 指定Dockerfile文件位置
docker build -t shykes/myapp . docker build -t shykes/myapp -f /path/Dockerfile /path docker build -t shykes/myapp http://www.example.com/Dockerfile CMD与ENTRYPOINT区别 CMD用法： •CMD [“executable”,“param1”,“param2”] ：exec形式（首选） •CMD [“param1”,“param2”] ：作为ENTRYPOINT的默认参数 •CMD command param1 param2 ：Shell形式 ENTRYPOINT用法： •ENTRYPOINT [“executable”, “param1”, “param2”] •ENTRYPOINT command param1 param2
小结： 1.CMD和ENTRYPOINT指令都可以用来定义运行容器时所使用的默认命令 2.Dockerfile至少指定一个CMD或ENTRYPOINT 3.CMD可以用作ENTRYPOINT默认参数，或者用作容器的默认命令 4.docker run指定时，将会覆盖CMD 5.如果是可执行文件，希望运行时传参，应该使用ENTRYPOINT
构建镜像例子 构建tomcat镜像，需要apache-tomcat-8....</p></section><footer class=entry-footer>2 min&nbsp;·&nbsp;332 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to docker镜像制作" href=https://wandong1.github.io/post/docker%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/></a></article><article class=post-entry><header class=entry-header><h2>expect实现免交互登录</h2></header><section class=entry-content><p>expect 安装 yum install -y expect 免交互切root用户 #!/usr/bin/expect set passwd "123456" set timeout 10 spawn su - expect { "Password:" { send "$passwd\r" } } interact 免交互ssh登录节点 #!/usr/bin/expect set timeout 10 set passwd "123456" spawn ssh wanye@172.17.0.17 -p 22 expect { "yes/no" { send "yes\r";exp_continue } "password:" { send "$passwd\r" } } interact</p></section><footer class=entry-footer>1 min&nbsp;·&nbsp;53 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to expect实现免交互登录" href=https://wandong1.github.io/post/expect%E5%AE%9E%E7%8E%B0%E5%85%8D%E4%BA%A4%E4%BA%92%E7%99%BB%E5%BD%95/></a></article><article class=post-entry><header class=entry-header><h2>Explain详解与索引最佳实践</h2></header><section class=entry-content><p>Explain工具介绍 使用EXPLAIN关键字可以模拟优化器执行SQL语句，分析你的查询语句或是结构的性能瓶颈
在 select 语句之前增加 explain 关键字，MySQL 会在查询上设置一个标记，执行查询会返回执行计划的信息，而不是执行这条SQL
注意：如果 from 中包含子查询，仍会执行该子查询，将结果放入临时表中
Explain分析示例 参考官方文档：https://dev.mysql.com/doc/refman/5.7/en/explain-output.html
示例表： DROP TABLE IF EXISTS `actor`; CREATE TABLE `actor` ( `id` int(11) NOT NULL, `name` varchar(45) DEFAULT NULL, `update_time` datetime DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO `actor` (`id`, `name`, `update_time`) VALUES (1,'a','2017-12-22 15:27:18'), (2,'b','2017-12-22 15:27:18'), (3,'c','2017-12-22 15:27:18'); DROP TABLE IF EXISTS `film`; CREATE TABLE `film` ( `id` int(11) NOT NULL AUTO_INCREMENT, `name` varchar(10) DEFAULT NULL, PRIMARY KEY (`id`), KEY `idx_name` (`name`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO `film` (`id`, `name`) VALUES (3,'film0'),(1,'film1'),(2,'film2'); DROP TABLE IF EXISTS `film_actor`; CREATE TABLE `film_actor` ( `id` int(11) NOT NULL, `film_id` int(11) NOT NULL, `actor_id` int(11) NOT NULL, `remark` varchar(255) DEFAULT NULL, PRIMARY KEY (`id`), KEY `idx_film_actor_id` (`film_id`,`actor_id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; INSERT INTO `film_actor` (`id`, `film_id`, `actor_id`) VALUES (1,1,1),(2,1,2),(3,2,1); mysql> explain select * from actor; 在查询中的每个表会输出一行，如果有两个表通过 join 连接查询，那么会输出两行...</p></section><footer class=entry-footer>5 min&nbsp;·&nbsp;1041 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Explain详解与索引最佳实践" href=https://wandong1.github.io/post/explain%E8%AF%A6%E8%A7%A3%E4%B8%8E%E7%B4%A2%E5%BC%95%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/></a></article><article class=post-entry><header class=entry-header><h2>Hello World</h2></header><section class=entry-content><p>Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.
Quick Start Create a new post $ hexo new "My New Post" More info: Writing
Run server $ hexo server More info: Server
Generate static files $ hexo generate More info: Generating
Deploy to remote sites $ hexo deploy More info: Deployment</p></section><footer class=entry-footer>1 min&nbsp;·&nbsp;78 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to Hello World" href=https://wandong1.github.io/post/hello-world/></a></article><article class=post-entry><header class=entry-header><h2>k8s集群负载均衡keepalived+nginx实现</h2></header><section class=entry-content><p>使用keepalived实现vip的动态飘逸 keepalived.conf 主
! Configuration File for keepalived global_defs { notification_email { acassen@firewall.loc failover@firewall.loc sysadmin@firewall.loc } notification_email_from Alexandre.Cassen@firewall.loc smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id LVS_DEVEL vrrp_skip_check_adv_addr vrrp_garp_interval 0 vrrp_gna_interval 0 } vrrp_script check_nginx { script "/etc/keepalived/check_nginx.sh" } vrrp_instance VI_1{ state MASTER interface ens34 virtual_router_id 51 priority 100 advert_int 1 authentication { auth_tpye PASS auth_pass 1111 } virtual_ipaddress { 192.168.200.59/24 } track_script { check_nginx } } keepalived.conf 备
! Configuration File for keepalived global_defs { notification_email { acassen@firewall....</p></section><footer class=entry-footer>2 min&nbsp;·&nbsp;370 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to k8s集群负载均衡keepalived+nginx实现" href=https://wandong1.github.io/post/k8s%E9%9B%86%E7%BE%A4%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1keepalived+nginx%E5%AE%9E%E7%8E%B0/></a></article><article class=post-entry><header class=entry-header><h2>kubeadm安装K8S集群</h2></header><section class=entry-content><p>kubeadm是官方社区推出的一个用于快速部署kubernetes集群的工具。
这个工具能通过两条指令完成一个kubernetes集群的部署：
# 创建一个 Master 节点
$ kubeadm init
# 将一个 Node 节点加入到当前集群中
$ kubeadm join &lt;Master节点的IP和端口 > 1. 安装要求 在开始之前，部署Kubernetes集群机器需要满足以下几个条件：
一台或多台机器，操作系统 CentOS7.x-86_x64 硬件配置：2GB或更多RAM，2个CPU或更多CPU，硬盘30GB或更多 集群中所有机器之间网络互通 可以访问外网，需要拉取镜像 禁止swap分区 2. 准备环境 角色 IP k8s-master 192.168.31.61 k8s-node1 192.168.31.62 k8s-node2 192.168.31.63 关闭防火墙：
$ systemctl stop firewalld
$ systemctl disable firewalld
关闭selinux：
$ sed -i 's/enforcing/disabled/' /etc/selinux/config # 永久
$ setenforce 0 # 临时
关闭swap：
$ swapoff -a # 临时
$ vim /etc/fstab # 永久
设置主机名：
$ hostnamectl set-hostname &lt;hostname>
在master添加hosts：
$ cat >> /etc/hosts &lt;&lt; EOF
192....</p></section><footer class=entry-footer>3 min&nbsp;·&nbsp;574 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to kubeadm安装K8S集群" href=https://wandong1.github.io/post/kubeadm%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4/></a></article><article class=post-entry><header class=entry-header><h2>kubectl命令补全</h2></header><section class=entry-content><p>一、kubectl命令补全 yum install -y bash-completion #临时生效
source /usr/share/bash-completion/bash_completion #永久生效
source &lt;(kubectl completion bash) echo "source &lt;(kubectl completion bash)" >> ~/.bashrc</p></section><footer class=entry-footer>1 min&nbsp;·&nbsp;20 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to kubectl命令补全" href=https://wandong1.github.io/post/kubectl%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%A8/></a></article><article class=post-entry><header class=entry-header><h2>kubectl管理命令概要</h2></header><section class=entry-content><p>kubectl管理命令概要 配置命令补全： http://123.207.224.155:8080/post/60
体验 使用Deployment控制器部署镜像：
kubectl create deployment web --image=lizhenliang/java-demo kubectl get deploy,pods 使用Service将Pod暴露出去：
kubectl expose deployment web --port=80 --target-port=8080 --type=NodePort kubectl get service 访问应用： http://NodeIP:Port # 端口随机生成，通过get svc获取
查看资源并显示标签
kubectl get pods --show-labels 根据查看带有指定标签名字的资源
kubectl get pod -l app=web https://kubernetes.io/docs 官方资料查询
YAML字段记忆技巧 用create命令生成 kubectl create deployment nginx --image=nginx:1.16 -o yaml --dry-run=client > my-deploy.yaml 用get命令导出 kubectl get deploymentnginx-o yaml > my-deploy.yaml Pod容器的字段拼写忘记了 kubectl explain pods.spec.containers kubectl explain deployment</p></section><footer class=entry-footer>1 min&nbsp;·&nbsp;68 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to kubectl管理命令概要" href=https://wandong1.github.io/post/kubectl%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4%E6%A6%82%E8%A6%81/></a></article><article class=post-entry><header class=entry-header><h2>linux系统根分区扩容</h2></header><section class=entry-content><p>扩容硬盘后进行如下操作。
fdisk /dev/vda1 确认只有一个vda1分区的情况下，按d删除分区，然后按n重新创建vda1分区，指定更大范围的sectors,且覆盖原有的sectors。 重启机器，后 resize2fs /dev/vda1
https://help.aliyun.com/document_detail/113316.html</p></section><footer class=entry-footer>1 min&nbsp;·&nbsp;8 words&nbsp;·&nbsp;Me</footer><a class=entry-link aria-label="post link to linux系统根分区扩容" href=https://wandong1.github.io/post/linux%E7%B3%BB%E7%BB%9F%E6%A0%B9%E5%88%86%E5%8C%BA%E6%89%A9%E5%AE%B9/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://wandong1.github.io/page/3/>« Prev Page</a>
<a class=next href=https://wandong1.github.io/page/5/>Next Page »</a></nav></footer></main><footer class=footer><span>&copy; 2022 <a href=https://wandong1.github.io>万东的云计算运维博客</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>