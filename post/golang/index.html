<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Golang学习笔记 | 万东的云计算运维博客</title><meta name=keywords content="go"><meta name=description content="Golang学习笔记"><meta name=author content="Me"><link rel=canonical href=https://wandong.notewan.com/post/golang/><link crossorigin=anonymous href=/assets/css/stylesheet.min.77d563e104d7b39d673d4f21adf63da1ad0244dbcd78291ac2b44dc25b0066e1.css integrity="sha256-d9Vj4QTXs51nPU8hrfY9oa0CRNvNeCkawrRNwlsAZuE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://wandong.notewan.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://wandong.notewan.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://wandong.notewan.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://wandong.notewan.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://wandong.notewan.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Golang学习笔记"><meta property="og:description" content="Golang学习笔记"><meta property="og:type" content="article"><meta property="og:url" content="https://wandong.notewan.com/post/golang/"><meta property="og:image" content="https://wandong.notewan.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-08-15T08:15:16+00:00"><meta property="article:modified_time" content="2022-08-15T08:15:16+00:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wandong.notewan.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Golang学习笔记"><meta name=twitter:description content="Golang学习笔记"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://wandong.notewan.com/post/"},{"@type":"ListItem","position":3,"name":"Golang学习笔记","item":"https://wandong.notewan.com/post/golang/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Golang学习笔记","name":"Golang学习笔记","description":"Golang学习笔记","keywords":["go"],"articleBody":"推荐博客 https://www.liwenzhou.com/posts/Go/golang-menu/\nLinux 安装go语言环境 # 下载地址 https://golang.google.cn/dl/ tar -xvzf go1.17.11.linux-386.tar.gz -C /usr/local yum install glibc.i686 -y mkdir -p /root/workspace cat \u003c\u003e /etc/profile export PATH=$PATH:/usr/local/go/bin export GOPATH=\"$HOME/workspace\" EOF source /etc/profile #设置国内代理 go env -w GOPROXY=https://goproxy.cn,direct #查看go env go env Linux下创建一个go项目 #查看GOPATH go env | grep -i gopath #GOPATH=\"/root/workspace\" cd /root/workspace;mkdir {src,bin,pkg} #进入src目录创建项目 cd src \u0026\u0026 mkdir GoRedis #随后编写main.go文件 构建多平台运行代码 go env -w GOOS=linux go env -w GOARCH=amd64 go build go env -w GOOS=windwos go env -w GOARCH=amd64 go build main.go文件内容 package main import ( \"context\" \"fmt\" \"github.com/go-redis/redis/v8\" ) var ctx = context.Background() func main() { rdb := redis.NewClient(\u0026redis.Options{ Addr: \"10.43.152.50:10001\", Password: \"f1543f7c\", // 密码 DB: 1, // 数据库 PoolSize: 20, // 连接池大小 }) pong, err := rdb.Ping(ctx).Result() fmt.Println(pong, err) } # 执行命令初始化mod go mod init GoRedis # 安装三方依赖包 go get github.com/go-redis/redis/v8 # 整个目录编译，编译后会生成对应系统的执行文件 go build # 运行文件 ./GoRedis Golang指针 任何程序数据载入内存后，在内存都有他们的地址，这就是指针。而为了保存一个数据在内存中的地址，我们就需要指针变量。\n比如，“永远不要高估自己”这句话是我的座右铭，我想把它写入程序中，程序一启动这句话是要加载到内存（假设内存地址0x123456），我在程序中把这段话赋值给变量A，把内存地址赋值给变量B。这时候变量B就是一个指针变量。通过变量A和变量B都能找到我的座右铭。\nGo语言中的指针不能进行偏移和运算，因此Go语言中的指针操作非常简单，我们只需要记住两个符号：\u0026（取地址）和*（根据地址取值）。\nx := 1 p := \u0026x fmt.Println(p) // 变量的内存地址 指针 fmt.Println(*p) //输出 1 *p = 2 // 相当于 x = 2 fmt.Println(x) // 输出2 var x,y int fmt.Println(\u0026x == \u0026x,\u0026x == \u0026y, \u0026x == nil) // 输出 true false false 总结： 取地址操作符\u0026和取值操作符*是一对互补操作符，\u0026取出地址，*根据地址取出地址指向的值。\n变量、指针地址、指针变量、取地址、取值的相互关系和特性如下：\n对变量进行取地址（\u0026）操作，可以获得这个变量的指针变量。 指针变量的值是指针地址。 对指针变量进行取值（*）操作，可以获得指针变量指向的原变量的值。 Golang并发编程 多线程介绍 A. 线程是由操作系统进行管理，也就是处于内核态。\nB. 线程之间进行切换，需要发生用户态到内核态的切换。\nC. 当系统中运行大量线程，系统会变的非常慢。\nD. 用户态的线程，支持大量线程创建。也叫协程或goroutine。\n1、串行、并发与并行 串行：我们都是先读小学，小学毕业后再读初中，读完初中再读高中。\n并发：同一时间段内执行多个任务（你在用微信和两个女朋友聊天）。\n并行：同一时刻执行多个任务（你和你朋友都在用微信和女朋友聊天）。\n2、进程、线程和协程 进程（process）：程序在操作系统中的一次执行过程，系统进行资源分配和调度的一个独立单位。\n线程（thread）：操作系统基于进程开启的轻量级进程，是操作系统调度执行的最小单位。\n协程（coroutine）：非操作系统提供而是由用户自行创建和控制的用户态‘线程’，比线程更轻量级。\n3、并发模型 业界将如何实现并发编程总结归纳为各式各样的并发模型，常见的并发模型有以下几种：\n线程\u0026锁模型\nActor模型\nCSP模型\nFork\u0026Join模型\nGo语言中的并发程序主要是通过基于CSP（communicating sequential processes）的goroutine和channel来实现，当然也支持使用传统的多线程共享内存的并发方式。\npackage main import ( \"fmt\" ) func hello() { fmt.Println(\"hello\") } func main() { go hello() // 开启线程 fmt.Println(\"你好\") } 多线程问题 执行以上代码，程序会退出，主线程执行完退出，主线程下开启的所有线程都会结束，hello()还没来得及执行就被打断了。\n解决办法：\n方法一： 在主函数中添加sleep，使用time.Sleep让 main goroutine 等待 hello goroutine执行结束是不优雅的，当然也是不准确的。\nfunc main() { go hello() fmt.Println(\"你好\") time.Sleep(time.Second) } 方法二： Go 语言中通过sync包为我们提供了一些常用的并发原语，我们会在后面的小节单独介绍sync包中的内容。在这一小节，我们会先介绍一下 sync 包中的WaitGroup。当你并不关心并发操作的结果或者有其它方式收集并发操作的结果时，WaitGroup是实现等待一组并发操作完成的好方法。\npackage main import ( \"fmt\" \"sync\" ) // 声明全局等待组变量 var wg sync.WaitGroup func hello() { fmt.Println(\"hello\") wg.Done() // 告知当前goroutine完成 } func main() { wg.Add(1) // 登记1个goroutine。启动一个goroutine，就需登记一个 go hello() fmt.Println(\"你好\") wg.Wait() // 阻塞等待登记的goroutine完成 } 登记多个goroutine\npackage main import ( \"fmt\" \"sync\" ) // 声明全局等待组变量 var wg sync.WaitGroup func hello(num int) { fmt.Println(\"hello\", num) wg.Done() // 告知当前goroutine完成 } func main() { for i := 0; i \u003c 10; i++ { wg.Add(1) // 登记1个goroutine go hello(i) } fmt.Println(\"你好\") wg.Wait() // 阻塞等待登记的goroutine完成 } 方法三： 利用channel。。。\npackage main import \"fmt\" func hello(num int, ch chan bool) { ch \u003c- true fmt.Println(\"hellooooo\", num) } func main() { var num = 15 ch := make(chan bool, num) for i := 0; i \u003c num; i++ { go hello(i, ch) } for j := 0; j \u003c num; j++ { \u003c-ch } fmt.Println(\"All go routines finished executing\") } GOMAXPROCS Go运行时的调度器使用GOMAXPROCS参数来确定需要使用多少个 OS 线程来同时执行 Go 代码。默认值是机器上的 CPU 核心数。例如在一个 8 核心的机器上，GOMAXPROCS 默认为 8。Go语言中可以通过runtime.GOMAXPROCS函数设置当前程序并发时占用的 CPU逻辑核心数。（Go1.5版本之前，默认使用的是单核心执行。Go1.5 版本之后，默认使用全部的CPU 逻辑核心数。）\nchannel 单纯地将函数并发执行是没有意义的。函数与函数间需要交换数据才能体现并发执行函数的意义。\n虽然可以使用共享内存进行数据交换，但是共享内存在不同的 goroutine 中容易发生竞态问题。为了保证数据交换的正确性，很多并发模型中必须使用互斥量对内存进行加锁，这种做法势必造成性能问题。\nGo语言采用的并发模型是CSP（Communicating Sequential Processes），提倡通过通信共享内存而不是通过共享内存而实现通信。\n如果说 goroutine 是Go程序并发的执行体，channel就是它们之间的连接。channel是可以让一个 goroutine 发送特定值到另一个 goroutine 的通信机制。\nGo 语言中的通道（channel）是一种特殊的类型。通道像一个传送带或者队列，总是遵循先入先出（First In First Out）的规则，保证收发数据的顺序。每一个通道都是一个具体类型的导管，也就是声明channel的时候需要为其指定元素类型。\nchannel类型 channel是 Go 语言中一种特有的类型。声明通道类型变量的格式如下：\nvar 变量名称 chan 元素类型 //元素类型：是指通道中传递元素的类型 //举例 var ch1 chan int // 声明一个传递整型的通道 var ch2 chan bool // 声明一个传递布尔型的通道 var ch3 chan []int // 声明一个传递int切片的通道 channel零值 未初始化的通道类型变量其默认零值是nil。\nvar ch chan int fmt.Println(ch) // 初始化channel 声明的通道类型变量需要使用内置的make函数初始化之后才能使用。具体格式如下：\nmake(chan 元素类型, [缓冲大小]) //channel的缓冲大小是可选的。 // 举个例子 ch4 := make(chan int) ch5 := make(chan bool, 1) // 声明一个缓冲区大小为1的通道 channel操作 通道共有发送（send）、接收(receive）和关闭（close）三种操作。而发送和接收操作都使用\u003c-符号。\nch := make(chan int) //发送 ch \u003c- 10 // 把10发送到ch中 //接收 x := \u003c- ch // 从ch中接收值并赋值给变量x \u003c-ch // 从ch中接收值，忽略结果 //关闭 close(ch) 关闭后的通道有以下特点：\n对一个关闭的通道再发送值就会导致 panic。 对一个关闭的通道进行接收会一直获取值直到通道为空。 对一个关闭的并且没有值的通道执行接收操作会得到对应类型的零值。 关闭一个已经关闭的通道会导致 panic。 无缓冲的通道 无缓冲的通道又称为阻塞的通道。我们来看一下如下代码片段。\nfunc main() { ch := make(chan int) ch \u003c- 10 fmt.Println(\"发送成功\") } 有缓冲的通道 func main() { ch := make(chan int, 1) // 创建一个容量为1的有缓冲区通道 ch \u003c- 10 fmt.Println(\"发送成功\") } 有缓冲通道的死锁情况 package main import ( \"fmt\" ) func main() { ch := make(chan string, 2) \u003c-ch //死锁 ch \u003c- \"hello\" ch \u003c- \"world\" ch \u003c- \"!\" // 死锁 fmt.Println(\u003c-ch) fmt.Println(\u003c-ch) } 多返回值模式 value, ok := \u003c- ch //value：从通道中取出的值，如果通道被关闭则返回对应类型的零值。 //ok：通道ch关闭时返回 false，否则返回 true。 for range接收值 通常我们会选择使用for range循环从通道中接收值，当通道被关闭后，会在通道内的所有值被接收完毕后会自动退出循环。上面那个示例我们使用for range改写后会很简洁。\nfunc f3(ch chan int) { for v := range ch { fmt.Println(v) } } select多路复用 package main import \"fmt\" func main() { ch := make(chan int, 1) // 打印基数 for i := 1; i \u003c= 10; i++ { select { case x := \u003c-ch: fmt.Println(x) case ch \u003c- i: } } } channel练习 解法1： package main import ( \"fmt\" \"math\" \"math/rand\" ) type Result struct { TaskId int Res string } var resultChan chan *Result func wsum(num int) string { needSum := []int{} for { if num \u003e= 10 { numOne := num % 10 needSum = append(needSum, numOne) num_buf := num / 10 num = int(math.Floor(float64(num_buf))) } else { needSum = append(needSum, num) break } } ret_sum := 0 for i := 0; i \u003c len(needSum); i++ { ret_sum += needSum[i] } // for v := range needSum { // ret_sum += v // fmt.Println(ret_sum) // } // fmt.Printf(\"%v sum is %d\\n\", needSum, ret_sum) return fmt.Sprintf(\"%v sum is %d\\n\", needSum, ret_sum) } func worker(tId int) { new_num := rand.Int() resInfo := Result{ TaskId: tId, Res: fmt.Sprintf(\"%v,%v\", new_num, wsum(new_num)), } // fmt.Println(resInfo) resultChan \u003c- \u0026resInfo } func main() { times := 100 resultChan = make(chan *Result, times) for i := 0; i \u003c times; i++ { go worker(i) } // for v := range resultChan { // fmt.Println(v) // } for j := 0; j \u003c times; j++ { fmt.Println(\u003c-resultChan) } } 解法2 package main import ( \"fmt\" \"math/rand\" \"strconv\" \"time\" ) type res struct { Num int EachSum int } var jobChan chan int var resultChan chan *res func computeInt(num int) (sumNum int) { time.Sleep(time.Second) strNum := strconv.Itoa(num) fmt.Printf(\"%v is %T\\n\", strNum, strNum) for i := 0; i \u003c len(strNum); i++ { eachNum := string(strNum[i]) eachNumInt, _ := strconv.Atoi(eachNum) sumNum += eachNumInt } return } func computeInt2(num int) (sumNum int) { for num \u003e 10 { sumNum += num % 10 num = num / 10 } time.Sleep(time.Second) return } func makeRandInt(jobChan chan int) { rand.Seed(time.Nanosecond.Nanoseconds()) for { num := rand.Int() jobChan \u003c- num } } func computeEachNumSum(jobChan chan int, resultChan chan *res) { for { num := \u003c-jobChan res := \u0026res{Num: num, EachSum: computeInt2(num)} resultChan \u003c- res } } func main() { jobChan = make(chan int) resultChan = make(chan *res) go makeRandInt(jobChan) for i := 0; i \u003c 24; i++ { go computeEachNumSum(jobChan, resultChan) } for v := range resultChan { fmt.Printf(\"%#v\\n\", *v) } } Golang Gin框架 go env -w GO111MODULE=on go env -w GOPROXY=https://goproxy.io,direct # 安装gin框架 go get -u github.com/gin-gonic/gin # 解决飘红 go mod init gin go mod edit -require github.com/gin-gonic/gin@latest go mod vendor go env -w GO111MODULE=on\rgo env -w GOPROXY=https://goproxy.io,direct 创建项目后，执行初始命令\ngo mod init 项目名 第一个Gin程序 package main import \"github.com/gin-gonic/gin\" func main() { r := gin.Default() // func 匿名函数 r.GET(\"/ping\", func(c *gin.Context) { //输出json结果给调用方 c.JSON(200, gin.H{ \"message\": \"pong\", }) }) r.Run() // listen and serve on 0.0.0.0:8080 } 另外一种写法 package main import \"github.com/gin-gonic/gin\" func testping(c *gin.Context) { c.JSON(200, gin.H{ \"message\": \"pong\", }) } func main() { r := gin.Default() r.GET(\"/ping\", testping) r.Run() // listen and serve on 0.0.0.0:8080 } GET和POST方法 package main import \"github.com/gin-gonic/gin\" func getPing(c *gin.Context) { c.JSON(200, gin.H{ \"message\": \"get pong\", }) } func postPing(c *gin.Context) { c.JSON(200, gin.H{ \"message\": \"post pong\", }) } func main() { r := gin.Default() r.GET(\"/ping\", getPing) r.POST(\"/ping\", postPing) r.Run() // listen and serve on 0.0.0.0:8080 } Gin框架路由分组 package main import \"github.com/gin-gonic/gin\" func login(ctx *gin.Context) { ctx.JSON(200, gin.H{ \"message\": \"success\", }) } func submit(ctx *gin.Context) { ctx.JSON(200, gin.H{ \"message\": \"success\", }) } func main() { //Default返回一个默认的路由引擎 router := gin.Default() // Simple group: v1 v1 := router.Group(\"/api/v1\") { v1.POST(\"/login\", login) v1.POST(\"/submit\", submit) } // Simple group: v2 v2 := router.Group(\"/api/v2\") { v2.POST(\"/login\", login) v2.POST(\"/submit\", submit) } _ = router.Run(\":8080\") } 参数绑定 package main import ( \"net/http\" \"github.com/gin-gonic/gin\" ) // Binding from JSON type Login struct { User string `form:\"user\" json:\"user\" binding:\"required\"` UserId int `form:\"user_id\" json:\"user_id\"` Password string `form:\"password\" json:\"password\" binding:\"required\"` } func main() { router := gin.Default() // Example for binding JSON ({\"user\": \"manu\", \"password\": \"123\"}) router.POST(\"/loginJSON\", func(c *gin.Context) { var login Login if err := c.ShouldBindJSON(\u0026login); err == nil { c.JSON(http.StatusOK, gin.H{ \"user\": login.User, \"user_id\": login.UserId, \"password\": login.Password, }) } else { c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()}) } }) // Example for binding a HTML form (user=manu\u0026password=123) router.POST(\"/loginForm\", func(c *gin.Context) { var login Login // This will infer what binder to use depending on the content-type header. if err := c.ShouldBind(\u0026login); err == nil { c.JSON(http.StatusOK, gin.H{ \"user\": login.User, \"password\": login.Password, }) } else { c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()}) } }) // Example for binding a HTML querystring (user=manu\u0026password=123) router.GET(\"/loginForm\", func(c *gin.Context) { var login Login if err := c.ShouldBind(\u0026login); err == nil { c.JSON(http.StatusOK, gin.H{ \"user\": login.User, \"password\": login.Password, }) } else { c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()}) } }) _ = router.Run(\":8080\") } json返回数据渲染 package main import ( \"net/http\" \"github.com/gin-gonic/gin\" ) func main() { r := gin.Default() // gin.H is a shortcut for map[string]interface{} r.GET(\"/someJSON\", func(c *gin.Context) { //第一种方式,自己拼json c.JSON(http.StatusOK, gin.H{\"message\": \"hey\", \"status\": http.StatusOK}) }) r.GET(\"/moreJSON\", func(c *gin.Context) { // 第二种方式 You also can use a struct var msg struct { Name string `json:\"user\"` Message string Number int } msg.Name = \"Lena\" msg.Message = \"hey\" msg.Number = 123 // Note that msg.Name becomes \"user\" in the JSON c.JSON(http.StatusOK, msg) }) // Listen and serve on 0.0.0.0:8080 r.Run(\":8080\") } swagger 生成接口文档 go get -u github.com/swaggo/swag/cmd/swag swag init package main import ( _ \"GinTest2/docs\" \"github.com/gin-gonic/gin\" swaggerFiles \"github.com/swaggo/files\" ginSwagger \"github.com/swaggo/gin-swagger\" ) func login(ctx *gin.Context) { ctx.JSON(200, gin.H{ \"message\": \"success\", }) } func submit(ctx *gin.Context) { ctx.JSON(200, gin.H{ \"message\": \"success\", }) } func main() { //Default返回一个默认的路由引擎 router := gin.Default() // Simple group: v1 v1 := router.Group(\"/api/v1\") { v1.POST(\"/login\", login) v1.POST(\"/submit\", submit) } // Simple group: v2 v2 := router.Group(\"/api/v2\") { v2.POST(\"/login\", login) v2.POST(\"/submit\", submit) } router.GET(\"/swagger/*any\", ginSwagger.WrapHandler(swaggerFiles.Handler)) _ = router.Run(\":8080\") } 访问接口文档 http://localhost:8080/swagger/index.html Golang 使用sqlx连接mysql数据库 安装三方包 go get github.com/go-sql-driver/mysql\rgo get github.com/jmoiron/sqlx main.go文件代码 package main import ( \"fmt\" _ \"github.com/go-sql-driver/mysql\" \"github.com/jmoiron/sqlx\" ) var db *sqlx.DB type user struct { Id int64 UserName string Pwd string } func initDB() (err error) { dsn := \"slbtraffic:1qaz#EDC@tcp(10.47.69.231:7306)/billing?charset=utf8mb4\u0026parseTime=True\" // 也可以使用MustConnect连接不成功就panic db, err = sqlx.Connect(\"mysql\", dsn) if err != nil { fmt.Printf(\"connect DB failed, err:%v\\n\", err) return } db.SetMaxOpenConns(20) db.SetMaxIdleConns(10) return } // 查询单条数据示例 func queryRowDemo() { sqlStr := \"select id, username, pwd from users where id=?\" var u user err := db.Get(\u0026u, sqlStr, 1) if err != nil { fmt.Printf(\"get failed, err:%v\\n\", err) return } fmt.Printf(\"id:%d name:%s age:%d\\n\", u.Id, u.UserName, u.Pwd) } // 查询多条数据示例 func queryMultiRowDemo() { sqlStr := \"select id, username, pwd from users\" var u []user err := db.Select(\u0026u, sqlStr) if err != nil { fmt.Printf(\"get multi row failed, err:%v\\n\", err) return } for _, val := range u { fmt.Printf(\"id:%d name:%s pwd:%s\\n\", val.Id, val.UserName, val.Pwd) } } // 插入数据 func insertRowDemo() { sqlStr := \"insert into users(username, pwd) values (?,?)\" ret, err := db.Exec(sqlStr, \"沙河小王子\", \"1235asd124142\") if err != nil { fmt.Printf(\"insert failed, err:%v\\n\", err) return } theID, err := ret.LastInsertId() // 新插入数据的id if err != nil { fmt.Printf(\"get lastinsert ID failed, err:%v\\n\", err) return } fmt.Printf(\"insert success, the id is %d.\\n\", theID) } // 更新数据 func updateRowDemo() { sqlStr := \"update users set username=? where username=? limit 1\" ret, err := db.Exec(sqlStr, \"沙河小王子sb\", \"沙河小王子\") if err != nil { fmt.Printf(\"upadte failed, err:%v\\n\", err) return } n, err := ret.RowsAffected() // 操作影响的行数 if err != nil { fmt.Printf(\"get RowsAffected failed, err:%v\\n\", err) return } fmt.Printf(\"update success, RowsAffected is %d.\\n\", n) } // 删除数据 func deleteRowDemo() { sqlStr := \"delete from users where id = ?\" ret, err := db.Exec(sqlStr, 6) if err != nil { fmt.Printf(\"delete failed, err:%v\\n\", err) return } n, err := ret.RowsAffected() // 操作影响的行数 if err != nil { fmt.Printf(\"get RowsAffected failed, err:%v\\n\", err) return } fmt.Printf(\"delete success, affected rows:%d\\n\", n) } func main() { initDB() queryRowDemo() // insertRowDemo() updateRowDemo() deleteRowDemo() queryMultiRowDemo() } Golang GORM教程 安装和连接 官方文档 https://gorm.io/zh_CN/docs/index.html\n# 创建项目 go mod init 项目名称 go get -u gorm.io/gorm go get -u gorm.io/driver/mysql package main import ( \"fmt\" \"gorm.io/driver/mysql\" \"gorm.io/gorm\" ) type Product struct { gorm.Model Code string `gorm:\"type:varchar(255)\"` Price uint } func main() { dsn := \"slbtraffic:1qaz#EDC@tcp(10.47.69.231:7306)/billing?charset=utf8mb4\u0026parseTime=True\u0026loc=Local\" db, err := gorm.Open(mysql.Open(dsn), \u0026gorm.Config{}) if err != nil { panic(\"failed to connect database\") } // 迁移 schema // db.AutoMigrate(\u0026Product{}) // // Create // db.Create(\u0026Product{Code: \"D43\", Price: 120}) // db.Create(\u0026Product{Code: \"D44\", Price: 120}) // db.Create(\u0026Product{Code: \"D45\", Price: 120}) // db.Create(\u0026Product{Code: \"D46\", Price: 120}) // 查询记录 var productData Product db.First(\u0026productData, 1) fmt.Printf(\"productData=%v\\n\", productData) // db.First(\u0026productData, \"code = ?\", \"D46\") // fmt.Printf(\"productData=%#v\\n\", productData) // 修改记录 将D46 修改为D666 // db.Model(\u0026productData).Update(\"code\", \"D666\") // Update - 更新多个字段 // db.Model(\u0026productData).Updates(Product{Price: 200, Code: \"F42\"}) // 仅更新非零值字段 // db.Model(\u0026productData).Updates(map[string]interface{}{\"Price\": 200, \"Code\": \"F42\"}) // 删除 // db.Delete(\u0026productData, 1) } Golang 操作redis 连接池 安装redis连接库 # 安装三方包 go get github.com/go-redis/redis/v8 # 插件官方 https://github.com/go-redis/redis # 官方文档 https://redis.uptrace.dev/guide/go-redis.html#installation package main import ( \"context\" \"fmt\" \"github.com/go-redis/redis/v8\" \"time\" ) var ctx = context.Background() func main() { rdb := redis.NewClient(\u0026redis.Options{ Addr: \"10.43.152.50:10001\", Password: \"f1543f7c\", // 密码 DB: 1, // 数据库 PoolSize: 20, // 连接池大小 }) pong, err := rdb.Ping(ctx).Result() fmt.Println(pong, err) // 直接执行命令获取错误 err = rdb.Set(ctx, \"key\", 520, time.Hour).Err() // 直接执行命令获取值 value := rdb.Get(ctx, \"key\").Val() fmt.Println(value) } Gin 框架 JWT的实现（重要） package main import ( \"errors\" \"net/http\" \"strings\" \"time\" \"github.com/gin-gonic/gin\" \"github.com/golang-jwt/jwt/v4\" ) // jwt 过期时间 const TokenExpireDuration = time.Hour * 2 // CustomSecret 用于加盐的字符串 var CustomSecret = []byte(\"夏天夏天悄悄过去\") type UserInfo struct { Username string Password string } type CustomClaims struct { // 可根据需要自行添加字段 Username string `json:\"username\"` jwt.RegisteredClaims // 内嵌标准的声明 } // GenToken 生成JWT func GenToken(username string) (string, error) { // 创建一个我们自己的声明 claims := CustomClaims{ username, // 自定义字段 jwt.RegisteredClaims{ ExpiresAt: jwt.NewNumericDate(time.Now().Add(TokenExpireDuration)), Issuer: \"my-project\", // 签发人 }, } // 使用指定的签名方法创建签名对象 token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims) // 使用指定的secret签名并获得完整的编码后的字符串token return token.SignedString(CustomSecret) } func authHandler(c *gin.Context) { // 用户发送用户名和密码过来 var user UserInfo err := c.ShouldBind(\u0026user) if err != nil { c.JSON(http.StatusOK, gin.H{ \"code\": 2001, \"msg\": \"无效的参数\", }) return } // 校验用户名和密码是否正确 if user.Username == \"q1mi\" \u0026\u0026 user.Password == \"q1mi123\" { // 生成Token tokenString, _ := GenToken(user.Username) c.JSON(http.StatusOK, gin.H{ \"code\": 2000, \"msg\": \"success\", \"data\": gin.H{\"token\": tokenString}, }) return } c.JSON(http.StatusOK, gin.H{ \"code\": 2002, \"msg\": \"鉴权失败\", }) return } // ParseToken 解析JWT func ParseToken(tokenString string) (*CustomClaims, error) { // 解析token // 如果是自定义Claim结构体则需要使用 ParseWithClaims 方法 token, err := jwt.ParseWithClaims(tokenString, \u0026CustomClaims{}, func(token *jwt.Token) (i interface{}, err error) { // 直接使用标准的Claim则可以直接使用Parse方法 //token, err := jwt.Parse(tokenString, func(token *jwt.Token) (i interface{}, err error) { return CustomSecret, nil }) if err != nil { return nil, err } // 对token对象中的Claim进行类型断言 if claims, ok := token.Claims.(*CustomClaims); ok \u0026\u0026 token.Valid { // 校验token return claims, nil } return nil, errors.New(\"invalid token\") } // JWTAuthMiddleware 基于JWT的认证中间件 func JWTAuthMiddleware() func(c *gin.Context) { return func(c *gin.Context) { // 客户端携带Token有三种方式 1.放在请求头 2.放在请求体 3.放在URI // 这里假设Token放在Header的Authorization中，并使用Bearer开头 // 这里的具体实现方式要依据你的实际业务情况决定 authHeader := c.Request.Header.Get(\"Authorization\") if authHeader == \"\" { c.JSON(http.StatusOK, gin.H{ \"code\": 2003, \"msg\": \"请求头中auth为空\", }) c.Abort() return } // 按空格分割 parts := strings.SplitN(authHeader, \" \", 2) if !(len(parts) == 2 \u0026\u0026 parts[0] == \"Bearer\") { c.JSON(http.StatusOK, gin.H{ \"code\": 2004, \"msg\": \"请求头中auth格式有误\", }) c.Abort() return } // parts[1]是获取到的tokenString，我们使用之前定义好的解析JWT的函数来解析它 mc, err := ParseToken(parts[1]) if err != nil { c.JSON(http.StatusOK, gin.H{ \"code\": 2005, \"msg\": \"无效的Token\", }) c.Abort() return } // 将当前请求的username信息保存到请求的上下文c上 c.Set(\"username\", mc.Username) c.Next() // 后续的处理函数可以用过c.Get(\"username\")来获取当前请求的用户信息 } } func homeHandler(c *gin.Context) { username := c.MustGet(\"username\").(string) c.JSON(http.StatusOK, gin.H{ \"code\": 2000, \"msg\": \"success\", \"data\": gin.H{\"username\": username}, }) } func main() { r := gin.Default() r.POST(\"/auth\", authHandler) r.GET(\"/home\", JWTAuthMiddleware(), homeHandler) r.Run() } swagger接口文档 用法步骤 按照swagger要求给接口代码添加声明式注释，具体参照声明式注释格式。 使用swag工具扫描代码自动生成API接口文档数据 使用gin-swagger渲染在线接口文档页面 安装swag工具，在注释编写完成后使用 go get -u github.com/swaggo/swag/cmd/swag swag init # 会生成docs目录 #./docs #├── docs.go #├── swagger.json #└── swagger.yaml 引入gin-swagger import ( _ \"GinJwt/docs\" // 千万不要忘了导入把你上一步生成的docs \"github.com/gin-gonic/gin\" swaggerFiles \"github.com/swaggo/files\" gs \"github.com/swaggo/gin-swagger\" ) 下载三方包 go get github.com/swaggo/gin-swagger go get github.com/swaggo/files package main import ( \"errors\" \"net/http\" \"strings\" \"time\" _ \"GinJwt/docs\" // 千万不要忘了导入把你上一步生成的docs \"github.com/gin-gonic/gin\" \"github.com/golang-jwt/jwt/v4\" swaggerFiles \"github.com/swaggo/files\" gs \"github.com/swaggo/gin-swagger\" ) // jwt 过期时间 const TokenExpireDuration = time.Hour * 2 // CustomSecret 用于加盐的字符串 var CustomSecret = []byte(\"夏天夏天悄悄过去\") type UserInfo struct { Username string Password string } type CustomClaims struct { // 可根据需要自行添加字段 Username string `json:\"username\"` jwt.RegisteredClaims // 内嵌标准的声明 } // GenToken 生成JWT func GenToken(username string) (string, error) { // 创建一个我们自己的声明 claims := CustomClaims{ username, // 自定义字段 jwt.RegisteredClaims{ ExpiresAt: jwt.NewNumericDate(time.Now().Add(TokenExpireDuration)), Issuer: \"my-project\", // 签发人 }, } // 使用指定的签名方法创建签名对象 token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims) // 使用指定的secret签名并获得完整的编码后的字符串token return token.SignedString(CustomSecret) } func authHandler(c *gin.Context) { // 用户发送用户名和密码过来 var user UserInfo err := c.ShouldBind(\u0026user) if err != nil { c.JSON(http.StatusOK, gin.H{ \"code\": 2001, \"msg\": \"无效的参数\", }) return } // 校验用户名和密码是否正确 if user.Username == \"q1mi\" \u0026\u0026 user.Password == \"q1mi123\" { // 生成Token tokenString, _ := GenToken(user.Username) c.JSON(http.StatusOK, gin.H{ \"code\": 2000, \"msg\": \"success\", \"data\": gin.H{\"token\": tokenString}, }) return } c.JSON(http.StatusOK, gin.H{ \"code\": 2002, \"msg\": \"鉴权失败\", }) return } // ParseToken 解析JWT func ParseToken(tokenString string) (*CustomClaims, error) { // 解析token // 如果是自定义Claim结构体则需要使用 ParseWithClaims 方法 token, err := jwt.ParseWithClaims(tokenString, \u0026CustomClaims{}, func(token *jwt.Token) (i interface{}, err error) { // 直接使用标准的Claim则可以直接使用Parse方法 //token, err := jwt.Parse(tokenString, func(token *jwt.Token) (i interface{}, err error) { return CustomSecret, nil }) if err != nil { return nil, err } // 对token对象中的Claim进行类型断言 if claims, ok := token.Claims.(*CustomClaims); ok \u0026\u0026 token.Valid { // 校验token return claims, nil } return nil, errors.New(\"invalid token\") } // JWTAuthMiddleware 基于JWT的认证中间件 func JWTAuthMiddleware() func(c *gin.Context) { return func(c *gin.Context) { // 客户端携带Token有三种方式 1.放在请求头 2.放在请求体 3.放在URI // 这里假设Token放在Header的Authorization中，并使用Bearer开头 // 这里的具体实现方式要依据你的实际业务情况决定 authHeader := c.Request.Header.Get(\"Authorization\") if authHeader == \"\" { c.JSON(http.StatusOK, gin.H{ \"code\": 2003, \"msg\": \"请求头中auth为空\", }) c.Abort() return } // 按空格分割 parts := strings.SplitN(authHeader, \" \", 2) if !(len(parts) == 2 \u0026\u0026 parts[0] == \"Bearer\") { c.JSON(http.StatusOK, gin.H{ \"code\": 2004, \"msg\": \"请求头中auth格式有误\", }) c.Abort() return } // parts[1]是获取到的tokenString，我们使用之前定义好的解析JWT的函数来解析它 mc, err := ParseToken(parts[1]) if err != nil { c.JSON(http.StatusOK, gin.H{ \"code\": 2005, \"msg\": \"无效的Token\", }) c.Abort() return } // 将当前请求的username信息保存到请求的上下文c上 c.Set(\"username\", mc.Username) c.Next() // 后续的处理函数可以用过c.Get(\"username\")来获取当前请求的用户信息 } } // homeHandler 测试jwt功能接口 // @Summary 测试jwt功能接口 // @Description 测试jwt功能接口 // @Tags 测试jwt功能接口 // @Accept application/json // @Produce application/json // @Param Authorization header string false \"Bearer 用户令牌\" // @Security ApiKeyAuth // @Success 200 // @Router /home [get] {\"username\": username} func homeHandler(c *gin.Context) { username := c.MustGet(\"username\").(string) c.JSON(http.StatusOK, gin.H{ \"code\": 2000, \"msg\": \"success\", \"data\": gin.H{\"username\": username}, }) } func main() { r := gin.Default() r.POST(\"/auth\", authHandler) r.GET(\"/home\", JWTAuthMiddleware(), homeHandler) r.GET(\"/swagger/*any\", gs.WrapHandler(swaggerFiles.Handler)) r.Run() } 访问地址 http://localhost:8080/swagger/index.html\nGolang三方库 gopsutil psutil是一个跨平台进程和系统监控的Python库，而gopsutil是其Go语言版本的实现。本文介绍了它的基本使用。\nGo语言部署简单、性能好的特点非常适合做一些诸如采集系统信息和监控的服务，本文介绍的gopsutil库是知名Python库：psutil的一个Go语言版本的实现。\n安装 go get github.com/shirou/gopsutil windows额外安装\ngo get github.com/yusufpapurcu/wmi go get golang.org/x/sys/windows 使用 采集CPU相关信息 import \"github.com/shirou/gopsutil/cpu\" import \"github.com/shirou/gopsutil/load\" import \"github.com/shirou/gopsutil/mem\" import \"github.com/shirou/gopsutil/host\" import \"github.com/shirou/gopsutil/disk\" import \"github.com/shirou/gopsutil/net\" // cpu info func getCpuInfo() { cpuInfos, err := cpu.Info() if err != nil { fmt.Printf(\"get cpu info failed, err:%v\", err) } for _, ci := range cpuInfos { fmt.Println(ci) } // CPU使用率 for { percent, _ := cpu.Percent(time.Second, false) fmt.Printf(\"cpu percent:%v\\n\", percent) } } func getCpuLoad() { info, _ := load.Avg() fmt.Printf(\"%v\\n\", info) } // mem info func getMemInfo() { memInfo, _ := mem.VirtualMemory() fmt.Printf(\"mem info:%v\\n\", memInfo) } // host info func getHostInfo() { hInfo, _ := host.Info() fmt.Printf(\"host info:%v uptime:%v boottime:%v\\n\", hInfo, hInfo.Uptime, hInfo.BootTime) } // disk info func getDiskInfo() { parts, err := disk.Partitions(true) if err != nil { fmt.Printf(\"get Partitions failed, err:%v\\n\", err) return } for _, part := range parts { fmt.Printf(\"part:%v\\n\", part.String()) diskInfo, _ := disk.Usage(part.Mountpoint) fmt.Printf(\"disk info:used:%v free:%v\\n\", diskInfo.UsedPercent, diskInfo.Free) } ioStat, _ := disk.IOCounters() for k, v := range ioStat { fmt.Printf(\"%v:%v\\n\", k, v) } } // net IO func getNetInfo() { info, _ := net.IOCounters(true) for index, v := range info { fmt.Printf(\"%v:%v send:%v recv:%v\\n\", index, v, v.BytesSent, v.BytesRecv) } } // get ip func GetLocalIP() (ip string, err error) { addrs, err := net.InterfaceAddrs() if err != nil { return } for _, addr := range addrs { ipAddr, ok := addr.(*net.IPNet) if !ok { continue } if ipAddr.IP.IsLoopback() { continue } if !ipAddr.IP.IsGlobalUnicast() { continue } return ipAddr.IP.String(), nil } return } 适用工具，上传下载文件 package main import ( \"flag\" \"fmt\" \"github.com/gin-gonic/gin\" \"io/ioutil\" \"log\" \"net/http\" ) var ( FileDir = flag.String(\"d\", \"D:\\\\golang_project\\\\src\\\\uploadDownload\\\\file_dir\", `-d 绝对路径 指定上传和下载的目录`) Port = flag.Int(\"p\", 8080,`-p 监听端口号 指定程序运行端口号`) ) func main() { flag.Parse() router := gin.Default() // 处理multipart forms提交文件时默认的内存限制是32 MiB // 可以通过下面的方式修改 // router.MaxMultipartMemory = 8 \u003c\u003c 20 // 8 MiB router.POST(\"/upload\", func(c *gin.Context) { // Multipart form form, _ := c.MultipartForm() files := form.File[\"file\"] for _, file := range files { log.Println(file.Filename) dst := fmt.Sprintf(\"%s/%s\", *FileDir, file.Filename) fmt.Println(dst) // 上传文件到指定的目录 c.SaveUploadedFile(file, dst) } c.JSON(http.StatusOK, gin.H{ \"message\": fmt.Sprintf(\"%d files uploaded!\", len(files)), }) }) router.GET(\"/listfile\", func(c *gin.Context) { fileInfoList, err := ioutil.ReadDir(*FileDir) var FileList []string for i := range fileInfoList { FileList = append(FileList,fileInfoList[i].Name()) } if err != nil { c.JSON(http.StatusBadRequest, gin.H{ \"code\": 400, \"msg\": \"Error\", }) }else { c.JSON(http.StatusOK, gin.H{ \"code\": 200, \"file_list\": FileList, }) } }) router.GET(\"/download/:file\", func(c *gin.Context) { filename := c.Param(\"file\") filepath := fmt.Sprintf(\"%s/%s\", *FileDir, filename) c.File(filepath) }) port := fmt.Sprintf(\":%d\",*Port) router.Run(port) } 常用函数 时间和日期相关函数 package main import ( \"fmt\" \"time\" ) func main() { // 日期和时间相关的函数 now := time.Now() fmt.Printf(\"%v \\n\", now) //2022-08-16 17:08:36.0952186 +0800 CST m=+0.007682101 // 获取时间其他相关信息 fmt.Printf(\"%v-%v-%v %v:%v:%v\\n\", now.Year(), int(now.Month()), now.Day(), now.Hour(), now.Minute(), now.Second()) // 格式化日期和时间 // 1、printf fmtTime := fmt.Sprintf(\"%v-%v-%v %v:%v:%v\", now.Year(), int(now.Month()), now.Day(), now.Hour(), now.Minute(), now.Second()) fmt.Println(fmtTime) // 2、使用官方的format函数 (推荐) fmt.Println(time.Now().Format(\"2006-01-02 15:04:05\")) fmt.Println(time.Now().Format(\"01-02\")) //时间 to 时间戳 loc, _ := time.LoadLocation(\"Asia/Shanghai\") //设置时区 tt, _ := time.ParseInLocation(\"2006-01-02 15:04:05\", \"2018-07-11 15:07:51\", loc) //2006-01-02 15:04:05是转换的格式如php的\"Y-m-d H:i:s\" fmt.Println(tt.Unix()) // 时间常量 const ( ns = time.Nanosecond us = time.Microsecond ms = time.Millisecond ss = time.Second ) // 时间戳 Unix UnixNano 纳秒 获取随机数字 fmt.Printf(\"unix时间戳=%v unixnano时间戳=%v\\n\", now.Unix(), now.UnixNano()) // 时间戳转日期 needConvertUnix := now.Unix() needConvertUnixTime := time.Unix(needConvertUnix, 0).Format(\"2006-01-02 15:04:05\") fmt.Printf(\"时间戳:%v is %v\\n\", needConvertUnix, needConvertUnixTime) // 时间加减 // 一天前的时间 oneDayBefore, _ := time.ParseDuration(\"-24h\") d1 := now.Add(oneDayBefore).Format(\"2006-01-02 15:04:05\") fmt.Printf(\"昨天的日期：%v \\n\", d1) d2 := now.AddDate(0, -1, 0).Format(\"2006-01-02 15:04:05\") fmt.Printf(\"上月的日期：%v\", d2) } os标准库 // 遍历所有环境遍历 envs := os.Environ() for _, value := range envs { cache := strings.Split(value, \"=\") fmt.Println(cache) } // 获取指定名称的环境变量 golandEnv := os.Getenv(\"GoLand\") fmt.Printf(\"golandEnv is %s\\n\", golandEnv) // 打印主机名 fmt.Println(os.Hostname()) // 获取当前路径 filePath, _ := os.Getwd() fmt.Println(filePath) bytes标准库 func TestConvertAb(t *testing.T) { var b = []byte(\"abcaBSADASD12-2131\") // 转大写 upper := bytes.ToUpper(b) // 转小写 lower := bytes.ToLower(b) fmt.Println(string(b), string(upper), string(lower)) var c = []byte(\"ABC\") var d = []byte(\"ABc\") // 忽略大小写比较 if bytes.EqualFold(c, d) { fmt.Printf(\"c:%v,d:%v c=d成立\\n\", c, d) } } ","wordCount":"3508","inLanguage":"en","datePublished":"2022-08-15T08:15:16Z","dateModified":"2022-08-15T08:15:16Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wandong.notewan.com/post/golang/"},"publisher":{"@type":"Organization","name":"万东的云计算运维博客","logo":{"@type":"ImageObject","url":"https://wandong.notewan.com/%3Clink%20/%20abs%20url%3E"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wandong.notewan.com accesskey=h title="万东的云计算运维博客 (Alt + H)"><img src=https://wandong.notewan.com/img-icon.png alt=logo aria-label=logo height=35>万东的云计算运维博客</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://wandong.notewan.com/categories/ title=分类><span>分类</span></a></li><li><a href=https://wandong.notewan.com/tags/ title=标签><span>标签</span></a></li><li><a href=https://wandong.notewan.com/archives/ title=归档><span>归档</span></a></li><li><a href=https://wandong.notewan.com/search title=搜索><span>搜索</span></a></li></ul></nav></header><main class="main page"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wandong.notewan.com>Home</a>&nbsp;»&nbsp;<a href=https://wandong.notewan.com/post/>Posts</a></div><h1 class=post-title>Golang学习笔记</h1><div class=post-description>Golang学习笔记</div><div class=post-meta><span title='2022-08-15 08:15:16 +0000 UTC'>August 15, 2022</span>&nbsp;·&nbsp;17 min&nbsp;·&nbsp;3508 words&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/post/golang.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#maingo文件内容>main.go文件内容</a></li></ul><ul><li><a href=#多线程介绍>多线程介绍</a><ul><li><a href=#1串行并发与并行>1、串行、并发与并行</a></li><li><a href=#2进程线程和协程>2、进程、线程和协程</a></li><li><a href=#3并发模型>3、并发模型</a></li></ul></li><li><a href=#多线程问题>多线程问题</a><ul><li><a href=#方法一>方法一：</a></li><li><a href=#方法二>方法二：</a></li><li><a href=#方法三>方法三：</a></li></ul></li><li><a href=#gomaxprocs>GOMAXPROCS</a></li><li><a href=#channel>channel</a><ul><li><a href=#channel类型>channel类型</a></li><li><a href=#channel零值>channel零值</a></li><li><a href=#初始化channel>初始化channel</a></li><li><a href=#channel操作>channel操作</a></li><li><a href=#无缓冲的通道>无缓冲的通道</a></li><li><a href=#有缓冲的通道>有缓冲的通道</a></li><li><a href=#多返回值模式>多返回值模式</a></li><li><a href=#for-range接收值>for range接收值</a></li><li><a href=#select多路复用>select多路复用</a></li><li><a href=#channel练习>channel练习</a></li></ul></li></ul><ul><li><a href=#第一个gin程序>第一个Gin程序</a></li><li><a href=#另外一种写法>另外一种写法</a></li><li><a href=#get和post方法>GET和POST方法</a></li><li><a href=#gin框架路由分组>Gin框架路由分组</a></li><li><a href=#参数绑定>参数绑定</a></li><li><a href=#json返回数据渲染>json返回数据渲染</a></li><li><a href=#swagger-生成接口文档>swagger 生成接口文档</a><ul><li></li></ul></li></ul><ul><li><a href=#安装三方包>安装三方包</a></li><li><a href=#maingo文件代码>main.go文件代码</a></li></ul><ul><li><a href=#安装和连接>安装和连接</a></li></ul><ul><li><a href=#安装redis连接库>安装redis连接库</a></li></ul><ul><li><a href=#用法步骤>用法步骤</a></li><li><a href=#安装swag工具在注释编写完成后使用>安装swag工具，在注释编写完成后使用</a></li><li><a href=#引入gin-swagger>引入gin-swagger</a><ul><li><a href=#下载三方包>下载三方包</a></li><li><a href=#访问地址>访问地址</a></li></ul></li></ul><ul><li><a href=#gopsutil>gopsutil</a><ul><li><a href=#安装>安装</a></li><li><a href=#使用>使用</a></li></ul></li></ul><ul><li><a href=#时间和日期相关函数>时间和日期相关函数</a></li><li><a href=#os标准库>os标准库</a></li><li><a href=#bytes标准库>bytes标准库</a></li></ul></nav></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>推荐博客 <a href=https://www.liwenzhou.com/posts/Go/golang-menu/>https://www.liwenzhou.com/posts/Go/golang-menu/</a></p><h1 id=linux-安装go语言环境>Linux 安装go语言环境<a hidden class=anchor aria-hidden=true href=#linux-安装go语言环境>#</a></h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 下载地址 https://golang.google.cn/dl/</span>
</span></span><span class=line><span class=cl>tar -xvzf go1.17.11.linux-386.tar.gz -C /usr/local
</span></span><span class=line><span class=cl>yum install glibc.i686 -y
</span></span><span class=line><span class=cl>mkdir -p /root/workspace
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt;EOF &gt;&gt; /etc/profile
</span></span></span><span class=line><span class=cl><span class=s>export PATH=$PATH:/usr/local/go/bin
</span></span></span><span class=line><span class=cl><span class=s>export GOPATH=&#34;$HOME/workspace&#34;
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>source</span> /etc/profile
</span></span><span class=line><span class=cl><span class=c1>#设置国内代理</span>
</span></span><span class=line><span class=cl>go env -w <span class=nv>GOPROXY</span><span class=o>=</span>https://goproxy.cn,direct
</span></span><span class=line><span class=cl><span class=c1>#查看go env</span>
</span></span><span class=line><span class=cl>go env
</span></span></code></pre></div><h1 id=linux下创建一个go项目>Linux下创建一个go项目<a hidden class=anchor aria-hidden=true href=#linux下创建一个go项目>#</a></h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1>#查看GOPATH</span>
</span></span><span class=line><span class=cl>go env <span class=p>|</span> grep -i gopath  <span class=c1>#GOPATH=&#34;/root/workspace&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> /root/workspace<span class=p>;</span>mkdir <span class=o>{</span>src,bin,pkg<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#进入src目录创建项目</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> src <span class=o>&amp;&amp;</span> mkdir GoRedis
</span></span><span class=line><span class=cl><span class=c1>#随后编写main.go文件</span>
</span></span></code></pre></div><h1 id=构建多平台运行代码>构建多平台运行代码<a hidden class=anchor aria-hidden=true href=#构建多平台运行代码>#</a></h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>go env -w <span class=nv>GOOS</span><span class=o>=</span>linux
</span></span><span class=line><span class=cl>go env -w <span class=nv>GOARCH</span><span class=o>=</span>amd64
</span></span><span class=line><span class=cl>go build
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>go env -w <span class=nv>GOOS</span><span class=o>=</span>windwos
</span></span><span class=line><span class=cl>go env -w <span class=nv>GOARCH</span><span class=o>=</span>amd64
</span></span><span class=line><span class=cl>go build
</span></span></code></pre></div><h2 id=maingo文件内容>main.go文件内容<a hidden class=anchor aria-hidden=true href=#maingo文件内容>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/go-redis/redis/v8&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>ctx</span> <span class=p>=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>rdb</span> <span class=o>:=</span> <span class=nx>redis</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>redis</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Addr</span><span class=p>:</span>     <span class=s>&#34;10.43.152.50:10001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Password</span><span class=p>:</span> <span class=s>&#34;f1543f7c&#34;</span><span class=p>,</span> <span class=c1>// 密码
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>DB</span><span class=p>:</span>       <span class=mi>1</span><span class=p>,</span>          <span class=c1>// 数据库
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>PoolSize</span><span class=p>:</span> <span class=mi>20</span><span class=p>,</span>         <span class=c1>// 连接池大小
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>pong</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rdb</span><span class=p>.</span><span class=nf>Ping</span><span class=p>(</span><span class=nx>ctx</span><span class=p>).</span><span class=nf>Result</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>pong</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 执行命令初始化mod</span>
</span></span><span class=line><span class=cl>go mod init GoRedis
</span></span><span class=line><span class=cl><span class=c1># 安装三方依赖包</span>
</span></span><span class=line><span class=cl>go get github.com/go-redis/redis/v8
</span></span><span class=line><span class=cl><span class=c1># 整个目录编译，编译后会生成对应系统的执行文件</span>
</span></span><span class=line><span class=cl>go build
</span></span><span class=line><span class=cl><span class=c1># 运行文件</span>
</span></span><span class=line><span class=cl>./GoRedis
</span></span></code></pre></div><h1 id=golang指针>Golang指针<a hidden class=anchor aria-hidden=true href=#golang指针>#</a></h1><p>任何程序数据载入内存后，在内存都有他们的地址，这就是指针。而为了保存一个数据在内存中的地址，我们就需要指针变量。</p><p>比如，“永远不要高估自己”这句话是我的座右铭，我想把它写入程序中，程序一启动这句话是要加载到内存（假设内存地址0x123456），我在程序中把这段话赋值给变量<code>A</code>，把内存地址赋值给变量<code>B</code>。这时候变量<code>B</code>就是一个指针变量。通过变量<code>A</code>和变量<code>B</code>都能找到我的座右铭。</p><p>Go语言中的指针不能进行偏移和运算，因此Go语言中的指针操作非常简单，我们只需要记住两个符号：<code>&</code>（取地址）和<code>*</code>（根据地址取值）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>x</span> <span class=o>:=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=nx>p</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>x</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>p</span><span class=p>)</span> <span class=c1>// 变量的内存地址 指针
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>*</span><span class=nx>p</span><span class=p>)</span>  <span class=c1>//输出 1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>*</span><span class=nx>p</span> <span class=p>=</span> <span class=mi>2</span>  <span class=c1>// 相当于 x = 2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span> <span class=c1>// 输出2
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>x</span><span class=p>,</span><span class=nx>y</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>x</span> <span class=o>==</span> <span class=o>&amp;</span><span class=nx>x</span><span class=p>,</span><span class=o>&amp;</span><span class=nx>x</span> <span class=o>==</span> <span class=o>&amp;</span><span class=nx>y</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>x</span> <span class=o>==</span> <span class=kc>nil</span><span class=p>)</span> <span class=c1>// 输出 true false false
</span></span></span></code></pre></div><p><strong>总结：</strong> 取地址操作符<code>&</code>和取值操作符<code>*</code>是一对互补操作符，<code>&</code>取出地址，<code>*</code>根据地址取出地址指向的值。</p><p>变量、指针地址、指针变量、取地址、取值的相互关系和特性如下：</p><ul><li>对变量进行取地址（&）操作，可以获得这个变量的指针变量。</li><li>指针变量的值是指针地址。</li><li>对指针变量进行取值（*）操作，可以获得指针变量指向的原变量的值。</li></ul><h1 id=golang并发编程>Golang并发编程<a hidden class=anchor aria-hidden=true href=#golang并发编程>#</a></h1><h2 id=多线程介绍>多线程介绍<a hidden class=anchor aria-hidden=true href=#多线程介绍>#</a></h2><p>A. 线程是由操作系统进行管理，也就是处于内核态。</p><p>B. 线程之间进行切换，需要发生用户态到内核态的切换。</p><p>C. 当系统中运行大量线程，系统会变的非常慢。</p><p>D. 用户态的线程，支持大量线程创建。也叫协程或goroutine。</p><h3 id=1串行并发与并行>1、串行、并发与并行<a hidden class=anchor aria-hidden=true href=#1串行并发与并行>#</a></h3><p>串行：我们都是先读小学，小学毕业后再读初中，读完初中再读高中。</p><p>并发：同一时间段内执行多个任务（你在用微信和两个女朋友聊天）。</p><p>并行：同一时刻执行多个任务（你和你朋友都在用微信和女朋友聊天）。</p><h3 id=2进程线程和协程>2、进程、线程和协程<a hidden class=anchor aria-hidden=true href=#2进程线程和协程>#</a></h3><p>进程（process）：程序在操作系统中的一次执行过程，系统进行资源分配和调度的一个独立单位。</p><p>线程（thread）：操作系统基于进程开启的轻量级进程，是操作系统调度执行的最小单位。</p><p>协程（coroutine）：非操作系统提供而是由用户自行创建和控制的用户态‘线程’，比线程更轻量级。</p><h3 id=3并发模型>3、并发模型<a hidden class=anchor aria-hidden=true href=#3并发模型>#</a></h3><p>业界将如何实现并发编程总结归纳为各式各样的并发模型，常见的并发模型有以下几种：</p><ul><li><p>线程&锁模型</p></li><li><p>Actor模型</p></li><li><p>CSP模型</p></li><li><p>Fork&Join模型</p><p>Go语言中的并发程序主要是通过基于CSP（communicating sequential processes）的goroutine和channel来实现，当然也支持使用传统的多线程共享内存的并发方式。</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>hello</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>go</span> <span class=nf>hello</span><span class=p>()</span> <span class=c1>// 开启线程
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;你好&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=多线程问题>多线程问题<a hidden class=anchor aria-hidden=true href=#多线程问题>#</a></h2><p>执行以上代码，程序会退出，主线程执行完退出，主线程下开启的所有线程都会结束，hello()还没来得及执行就被打断了。</p><p>解决办法：</p><h3 id=方法一>方法一：<a hidden class=anchor aria-hidden=true href=#方法一>#</a></h3><p>在主函数中添加sleep，使用<code>time.Sleep</code>让 main goroutine 等待 hello goroutine执行结束是不优雅的，当然也是不准确的。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>go</span> <span class=nf>hello</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;你好&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=方法二>方法二：<a hidden class=anchor aria-hidden=true href=#方法二>#</a></h3><p>Go 语言中通过<code>sync</code>包为我们提供了一些常用的并发原语，我们会在后面的小节单独介绍<code>sync</code>包中的内容。在这一小节，我们会先介绍一下 sync 包中的<code>WaitGroup</code>。当你并不关心并发操作的结果或者有其它方式收集并发操作的结果时，<code>WaitGroup</code>是实现等待一组并发操作完成的好方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 声明全局等待组变量
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>wg</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>WaitGroup</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>hello</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wg</span><span class=p>.</span><span class=nf>Done</span><span class=p>()</span> <span class=c1>// 告知当前goroutine完成
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>wg</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>// 登记1个goroutine。启动一个goroutine，就需登记一个
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>go</span> <span class=nf>hello</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;你好&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wg</span><span class=p>.</span><span class=nf>Wait</span><span class=p>()</span> <span class=c1>// 阻塞等待登记的goroutine完成
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>登记多个goroutine</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 声明全局等待组变量
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>wg</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>WaitGroup</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>hello</span><span class=p>(</span><span class=nx>num</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>,</span> <span class=nx>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wg</span><span class=p>.</span><span class=nf>Done</span><span class=p>()</span> <span class=c1>// 告知当前goroutine完成
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>wg</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>// 登记1个goroutine
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>go</span> <span class=nf>hello</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;你好&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>wg</span><span class=p>.</span><span class=nf>Wait</span><span class=p>()</span> <span class=c1>// 阻塞等待登记的goroutine完成
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=方法三>方法三：<a hidden class=anchor aria-hidden=true href=#方法三>#</a></h3><p>利用channel。。。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>hello</span><span class=p>(</span><span class=nx>num</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>ch</span> <span class=kd>chan</span> <span class=kt>bool</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ch</span> <span class=o>&lt;-</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;hellooooo&#34;</span><span class=p>,</span> <span class=nx>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>num</span> <span class=p>=</span> <span class=mi>15</span>
</span></span><span class=line><span class=cl>	<span class=nx>ch</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>bool</span><span class=p>,</span> <span class=nx>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>num</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>go</span> <span class=nf>hello</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span> <span class=nx>ch</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>num</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=o>&lt;-</span><span class=nx>ch</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;All go routines finished executing&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=gomaxprocs>GOMAXPROCS<a hidden class=anchor aria-hidden=true href=#gomaxprocs>#</a></h2><p>Go运行时的调度器使用<code>GOMAXPROCS</code>参数来确定需要使用多少个 OS 线程来同时执行 Go 代码。默认值是机器上的 CPU 核心数。例如在一个 8 核心的机器上，GOMAXPROCS 默认为 8。Go语言中可以通过<code>runtime.GOMAXPROCS</code>函数设置当前程序并发时占用的 CPU逻辑核心数。（<code>Go1.5版本之前</code>，默认使用的是单核心执行。<code>Go1.5 版本之后</code>，默认使用全部的CPU 逻辑核心数。）</p><h2 id=channel>channel<a hidden class=anchor aria-hidden=true href=#channel>#</a></h2><p>单纯地将函数并发执行是没有意义的。函数与函数间需要交换数据才能体现并发执行函数的意义。</p><p>虽然可以使用共享内存进行数据交换，但是共享内存在不同的 goroutine 中容易发生竞态问题。为了保证数据交换的正确性，很多并发模型中必须使用互斥量对内存进行加锁，这种做法势必造成性能问题。</p><p>Go语言采用的并发模型是<code>CSP（Communicating Sequential Processes）</code>，提倡<strong>通过通信共享内存</strong>而不是<strong>通过共享内存而实现通信</strong>。</p><p>如果说 goroutine 是Go程序并发的执行体，<code>channel</code>就是它们之间的连接。<code>channel</code>是可以让一个 goroutine 发送特定值到另一个 goroutine 的通信机制。</p><p>Go 语言中的通道（channel）是一种特殊的类型。通道像一个传送带或者队列，总是遵循先入先出（First In First Out）的规则，保证收发数据的顺序。每一个通道都是一个具体类型的导管，也就是声明channel的时候需要为其指定元素类型。</p><h3 id=channel类型>channel类型<a hidden class=anchor aria-hidden=true href=#channel类型>#</a></h3><p><code>channel</code>是 Go 语言中一种特有的类型。声明通道类型变量的格式如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>变量名称</span> <span class=kd>chan</span> <span class=nx>元素类型</span> <span class=c1>//元素类型：是指通道中传递元素的类型
</span></span></span><span class=line><span class=cl><span class=c1>//举例
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>ch1</span> <span class=kd>chan</span> <span class=kt>int</span>   <span class=c1>// 声明一个传递整型的通道
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>ch2</span> <span class=kd>chan</span> <span class=kt>bool</span>  <span class=c1>// 声明一个传递布尔型的通道
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>ch3</span> <span class=kd>chan</span> <span class=p>[]</span><span class=kt>int</span> <span class=c1>// 声明一个传递int切片的通道
</span></span></span></code></pre></div><h3 id=channel零值>channel零值<a hidden class=anchor aria-hidden=true href=#channel零值>#</a></h3><p>未初始化的通道类型变量其默认零值是<code>nil</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>ch</span> <span class=kd>chan</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>ch</span><span class=p>)</span> <span class=c1>// &lt;nil&gt;
</span></span></span></code></pre></div><h3 id=初始化channel>初始化channel<a hidden class=anchor aria-hidden=true href=#初始化channel>#</a></h3><p>声明的通道类型变量需要使用内置的<code>make</code>函数初始化之后才能使用。具体格式如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=nx>元素类型</span><span class=p>,</span> <span class=p>[</span><span class=nx>缓冲大小</span><span class=p>])</span> <span class=c1>//channel的缓冲大小是可选的。
</span></span></span><span class=line><span class=cl><span class=c1>// 举个例子
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>ch4</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>ch5</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>bool</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>  <span class=c1>// 声明一个缓冲区大小为1的通道
</span></span></span></code></pre></div><h3 id=channel操作>channel操作<a hidden class=anchor aria-hidden=true href=#channel操作>#</a></h3><p>通道共有发送（send）、接收(receive）和关闭（close）三种操作。而发送和接收操作都使用<code>&lt;-</code>符号。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>ch</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>//发送
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>ch</span> <span class=o>&lt;-</span> <span class=mi>10</span> <span class=c1>// 把10发送到ch中  
</span></span></span><span class=line><span class=cl><span class=c1>//接收
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>x</span> <span class=o>:=</span> <span class=o>&lt;-</span> <span class=nx>ch</span> <span class=c1>// 从ch中接收值并赋值给变量x
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>&lt;-</span><span class=nx>ch</span>       <span class=c1>// 从ch中接收值，忽略结果
</span></span></span><span class=line><span class=cl><span class=c1>//关闭
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>close</span><span class=p>(</span><span class=nx>ch</span><span class=p>)</span> 
</span></span></code></pre></div><p>关闭后的通道有以下特点：</p><ol><li>对一个关闭的通道再发送值就会导致 panic。</li><li>对一个关闭的通道进行接收会一直获取值直到通道为空。</li><li>对一个关闭的并且没有值的通道执行接收操作会得到对应类型的零值。</li><li>关闭一个已经关闭的通道会导致 panic。</li></ol><h3 id=无缓冲的通道>无缓冲的通道<a hidden class=anchor aria-hidden=true href=#无缓冲的通道>#</a></h3><p>无缓冲的通道又称为阻塞的通道。我们来看一下如下代码片段。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ch</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>ch</span> <span class=o>&lt;-</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;发送成功&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=有缓冲的通道>有缓冲的通道<a hidden class=anchor aria-hidden=true href=#有缓冲的通道>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ch</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=c1>// 创建一个容量为1的有缓冲区通道
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>ch</span> <span class=o>&lt;-</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;发送成功&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=有缓冲通道的死锁情况>有缓冲通道的死锁情况<a hidden class=anchor aria-hidden=true href=#有缓冲通道的死锁情况>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ch</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>string</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>&lt;-</span><span class=nx>ch</span> <span class=c1>//死锁
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>ch</span> <span class=o>&lt;-</span> <span class=s>&#34;hello&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>ch</span> <span class=o>&lt;-</span> <span class=s>&#34;world&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>ch</span> <span class=o>&lt;-</span> <span class=s>&#34;!&#34;</span> <span class=c1>// 死锁
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>&lt;-</span><span class=nx>ch</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>&lt;-</span><span class=nx>ch</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=多返回值模式>多返回值模式<a hidden class=anchor aria-hidden=true href=#多返回值模式>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>value</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=o>&lt;-</span> <span class=nx>ch</span>
</span></span><span class=line><span class=cl><span class=c1>//value：从通道中取出的值，如果通道被关闭则返回对应类型的零值。
</span></span></span><span class=line><span class=cl><span class=c1>//ok：通道ch关闭时返回 false，否则返回 true。
</span></span></span></code></pre></div><h3 id=for-range接收值>for range接收值<a hidden class=anchor aria-hidden=true href=#for-range接收值>#</a></h3><p>通常我们会选择使用<code>for range</code>循环从通道中接收值，当通道被关闭后，会在通道内的所有值被接收完毕后会自动退出循环。上面那个示例我们使用<code>for range</code>改写后会很简洁。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>f3</span><span class=p>(</span><span class=nx>ch</span> <span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>v</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>ch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=select多路复用>select多路复用<a hidden class=anchor aria-hidden=true href=#select多路复用>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ch</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 打印基数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>1</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;=</span> <span class=mi>10</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=nx>x</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>ch</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=nx>ch</span> <span class=o>&lt;-</span> <span class=nx>i</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=channel练习>channel练习<a hidden class=anchor aria-hidden=true href=#channel练习>#</a></h3><h4 id=解法1>解法1：<a hidden class=anchor aria-hidden=true href=#解法1>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;math&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;math/rand&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Result</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>TaskId</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>Res</span>    <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>resultChan</span> <span class=kd>chan</span> <span class=o>*</span><span class=nx>Result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>wsum</span><span class=p>(</span><span class=nx>num</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>needSum</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>int</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>num</span> <span class=o>&gt;=</span> <span class=mi>10</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>numOne</span> <span class=o>:=</span> <span class=nx>num</span> <span class=o>%</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>			<span class=nx>needSum</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>needSum</span><span class=p>,</span> <span class=nx>numOne</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>num_buf</span> <span class=o>:=</span> <span class=nx>num</span> <span class=o>/</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>			<span class=nx>num</span> <span class=p>=</span> <span class=nb>int</span><span class=p>(</span><span class=nx>math</span><span class=p>.</span><span class=nf>Floor</span><span class=p>(</span><span class=nb>float64</span><span class=p>(</span><span class=nx>num_buf</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>needSum</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>needSum</span><span class=p>,</span> <span class=nx>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>break</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>ret_sum</span> <span class=o>:=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>needSum</span><span class=p>);</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ret_sum</span> <span class=o>+=</span> <span class=nx>needSum</span><span class=p>[</span><span class=nx>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// for v := range needSum {
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 	ret_sum += v
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 	fmt.Println(ret_sum)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// fmt.Printf(&#34;%v sum is %d\n&#34;, needSum, ret_sum)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%v sum is %d\n&#34;</span><span class=p>,</span> <span class=nx>needSum</span><span class=p>,</span> <span class=nx>ret_sum</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>worker</span><span class=p>(</span><span class=nx>tId</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>new_num</span> <span class=o>:=</span> <span class=nx>rand</span><span class=p>.</span><span class=nf>Int</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>resInfo</span> <span class=o>:=</span> <span class=nx>Result</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>TaskId</span><span class=p>:</span> <span class=nx>tId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Res</span><span class=p>:</span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%v,%v&#34;</span><span class=p>,</span> <span class=nx>new_num</span><span class=p>,</span> <span class=nf>wsum</span><span class=p>(</span><span class=nx>new_num</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// fmt.Println(resInfo)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>resultChan</span> <span class=o>&lt;-</span> <span class=o>&amp;</span><span class=nx>resInfo</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>times</span> <span class=o>:=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>	<span class=nx>resultChan</span> <span class=p>=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=o>*</span><span class=nx>Result</span><span class=p>,</span> <span class=nx>times</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nx>times</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>go</span> <span class=nf>worker</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// for v := range resultChan {
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 	fmt.Println(v)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>for</span> <span class=nx>j</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>j</span> <span class=p>&lt;</span> <span class=nx>times</span><span class=p>;</span> <span class=nx>j</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>&lt;-</span><span class=nx>resultChan</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=解法2>解法2<a hidden class=anchor aria-hidden=true href=#解法2>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;math/rand&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;strconv&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>res</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Num</span>     <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=nx>EachSum</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>jobChan</span> <span class=kd>chan</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>resultChan</span> <span class=kd>chan</span> <span class=o>*</span><span class=nx>res</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>computeInt</span><span class=p>(</span><span class=nx>num</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>sumNum</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>strNum</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>Itoa</span><span class=p>(</span><span class=nx>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%v is %T\n&#34;</span><span class=p>,</span> <span class=nx>strNum</span><span class=p>,</span> <span class=nx>strNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>strNum</span><span class=p>);</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>eachNum</span> <span class=o>:=</span> <span class=nb>string</span><span class=p>(</span><span class=nx>strNum</span><span class=p>[</span><span class=nx>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=nx>eachNumInt</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>Atoi</span><span class=p>(</span><span class=nx>eachNum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>sumNum</span> <span class=o>+=</span> <span class=nx>eachNumInt</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>computeInt2</span><span class=p>(</span><span class=nx>num</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>sumNum</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>num</span> <span class=p>&gt;</span> <span class=mi>10</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>sumNum</span> <span class=o>+=</span> <span class=nx>num</span> <span class=o>%</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>		<span class=nx>num</span> <span class=p>=</span> <span class=nx>num</span> <span class=o>/</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>makeRandInt</span><span class=p>(</span><span class=nx>jobChan</span> <span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>rand</span><span class=p>.</span><span class=nf>Seed</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Nanosecond</span><span class=p>.</span><span class=nf>Nanoseconds</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>num</span> <span class=o>:=</span> <span class=nx>rand</span><span class=p>.</span><span class=nf>Int</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nx>jobChan</span> <span class=o>&lt;-</span> <span class=nx>num</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>computeEachNumSum</span><span class=p>(</span><span class=nx>jobChan</span> <span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>resultChan</span> <span class=kd>chan</span> <span class=o>*</span><span class=nx>res</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>num</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>jobChan</span>
</span></span><span class=line><span class=cl>		<span class=nx>res</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>res</span><span class=p>{</span><span class=nx>Num</span><span class=p>:</span> <span class=nx>num</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>EachSum</span><span class=p>:</span> <span class=nf>computeInt2</span><span class=p>(</span><span class=nx>num</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>		<span class=nx>resultChan</span> <span class=o>&lt;-</span> <span class=nx>res</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>jobChan</span> <span class=p>=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>resultChan</span> <span class=p>=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=o>*</span><span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>go</span> <span class=nf>makeRandInt</span><span class=p>(</span><span class=nx>jobChan</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>24</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>go</span> <span class=nf>computeEachNumSum</span><span class=p>(</span><span class=nx>jobChan</span><span class=p>,</span> <span class=nx>resultChan</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>v</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>resultChan</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%#v\n&#34;</span><span class=p>,</span> <span class=o>*</span><span class=nx>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=golang-gin框架>Golang Gin框架<a hidden class=anchor aria-hidden=true href=#golang-gin框架>#</a></h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>go env -w <span class=nv>GO111MODULE</span><span class=o>=</span>on
</span></span><span class=line><span class=cl>go env -w <span class=nv>GOPROXY</span><span class=o>=</span>https://goproxy.io,direct
</span></span><span class=line><span class=cl><span class=c1># 安装gin框架</span>
</span></span><span class=line><span class=cl>go get -u github.com/gin-gonic/gin 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 解决飘红</span>
</span></span><span class=line><span class=cl>go mod init gin
</span></span><span class=line><span class=cl>go mod edit -require github.com/gin-gonic/gin@latest
</span></span><span class=line><span class=cl>go mod vendor
</span></span></code></pre></div><pre tabindex=0><code>go env -w GO111MODULE=on
go env -w GOPROXY=https://goproxy.io,direct
</code></pre><p><img loading=lazy src=C:%5cUsers%5cAdministrator%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20220708151719430.png alt=image-20220708151719430></p><p>创建项目后，执行初始命令</p><pre tabindex=0><code>go mod init 项目名
</code></pre><h2 id=第一个gin程序>第一个Gin程序<a hidden class=anchor aria-hidden=true href=#第一个gin程序>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1>// func 匿名函数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>r</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/ping&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>//输出json结果给调用方
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;message&#34;</span><span class=p>:</span> <span class=s>&#34;pong&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>Run</span><span class=p>()</span> <span class=c1>// listen and serve on 0.0.0.0:8080
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=另外一种写法>另外一种写法<a hidden class=anchor aria-hidden=true href=#另外一种写法>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>testping</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span>  <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;message&#34;</span><span class=p>:</span> <span class=s>&#34;pong&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/ping&#34;</span><span class=p>,</span> <span class=nx>testping</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>Run</span><span class=p>()</span> <span class=c1>// listen and serve on 0.0.0.0:8080
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=get和post方法>GET和POST方法<a hidden class=anchor aria-hidden=true href=#get和post方法>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>getPing</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span>  <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;message&#34;</span><span class=p>:</span> <span class=s>&#34;get pong&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>postPing</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span>  <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;message&#34;</span><span class=p>:</span> <span class=s>&#34;post pong&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/ping&#34;</span><span class=p>,</span> <span class=nx>getPing</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/ping&#34;</span><span class=p>,</span> <span class=nx>postPing</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>Run</span><span class=p>()</span> <span class=c1>// listen and serve on 0.0.0.0:8080
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><h2 id=gin框架路由分组>Gin框架路由分组<a hidden class=anchor aria-hidden=true href=#gin框架路由分组>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>login</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ctx</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;message&#34;</span><span class=p>:</span> <span class=s>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>submit</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ctx</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;message&#34;</span><span class=p>:</span> <span class=s>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>//Default返回一个默认的路由引擎
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>router</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Simple group: v1
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>v1</span> <span class=o>:=</span> <span class=nx>router</span><span class=p>.</span><span class=nf>Group</span><span class=p>(</span><span class=s>&#34;/api/v1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>v1</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/login&#34;</span><span class=p>,</span> <span class=nx>login</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>v1</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/submit&#34;</span><span class=p>,</span> <span class=nx>submit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Simple group: v2
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>v2</span> <span class=o>:=</span> <span class=nx>router</span><span class=p>.</span><span class=nf>Group</span><span class=p>(</span><span class=s>&#34;/api/v2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>v2</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/login&#34;</span><span class=p>,</span> <span class=nx>login</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>v2</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/submit&#34;</span><span class=p>,</span> <span class=nx>submit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=p>=</span> <span class=nx>router</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;:8080&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=参数绑定>参数绑定<a hidden class=anchor aria-hidden=true href=#参数绑定>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Binding from JSON
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Login</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>User</span> <span class=kt>string</span> <span class=s>`form:&#34;user&#34; json:&#34;user&#34; binding:&#34;required&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>UserId</span> <span class=kt>int</span> <span class=s>`form:&#34;user_id&#34; json:&#34;user_id&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Password</span> <span class=kt>string</span> <span class=s>`form:&#34;password&#34; json:&#34;password&#34; binding:&#34;required&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>router</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Example for binding JSON ({&#34;user&#34;: &#34;manu&#34;, &#34;password&#34;: &#34;123&#34;})
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>router</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/loginJSON&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=nx>login</span> <span class=nx>Login</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>ShouldBindJSON</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>login</span><span class=p>);</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;user&#34;</span><span class=p>:</span> <span class=nx>login</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;user_id&#34;</span><span class=p>:</span> <span class=nx>login</span><span class=p>.</span><span class=nx>UserId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;password&#34;</span><span class=p>:</span> <span class=nx>login</span><span class=p>.</span><span class=nx>Password</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;error&#34;</span><span class=p>:</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Example for binding a HTML form (user=manu&amp;password=123)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>router</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/loginForm&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=nx>login</span> <span class=nx>Login</span>
</span></span><span class=line><span class=cl>		<span class=c1>// This will infer what binder to use depending on the content-type header.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>ShouldBind</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>login</span><span class=p>);</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;user&#34;</span><span class=p>:</span> <span class=nx>login</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;password&#34;</span><span class=p>:</span> <span class=nx>login</span><span class=p>.</span><span class=nx>Password</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;error&#34;</span><span class=p>:</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Example for binding a HTML querystring (user=manu&amp;password=123)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>router</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/loginForm&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=nx>login</span> <span class=nx>Login</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>ShouldBind</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>login</span><span class=p>);</span> <span class=nx>err</span> <span class=o>==</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;user&#34;</span><span class=p>:</span> <span class=nx>login</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;password&#34;</span><span class=p>:</span> <span class=nx>login</span><span class=p>.</span><span class=nx>Password</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;error&#34;</span><span class=p>:</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=p>=</span> <span class=nx>router</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;:8080&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=json返回数据渲染>json返回数据渲染<a hidden class=anchor aria-hidden=true href=#json返回数据渲染>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// gin.H is a shortcut for map[string]interface{}
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>r</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/someJSON&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>//第一种方式,自己拼json
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;message&#34;</span><span class=p>:</span> <span class=s>&#34;hey&#34;</span><span class=p>,</span> <span class=s>&#34;status&#34;</span><span class=p>:</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/moreJSON&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 第二种方式 You also can use a struct
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=kd>var</span> <span class=nx>msg</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Name</span> <span class=kt>string</span> <span class=s>`json:&#34;user&#34;`</span>
</span></span><span class=line><span class=cl>			<span class=nx>Message</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>			<span class=nx>Number</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nx>msg</span><span class=p>.</span><span class=nx>Name</span> <span class=p>=</span> <span class=s>&#34;Lena&#34;</span>
</span></span><span class=line><span class=cl>		<span class=nx>msg</span><span class=p>.</span><span class=nx>Message</span> <span class=p>=</span> <span class=s>&#34;hey&#34;</span>
</span></span><span class=line><span class=cl>		<span class=nx>msg</span><span class=p>.</span><span class=nx>Number</span> <span class=p>=</span> <span class=mi>123</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Note that msg.Name becomes &#34;user&#34; in the JSON
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Listen and serve on 0.0.0.0:8080
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>r</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;:8080&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=swagger-生成接口文档>swagger 生成接口文档<a hidden class=anchor aria-hidden=true href=#swagger-生成接口文档>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>go get -u github.com/swaggo/swag/cmd/swag
</span></span><span class=line><span class=cl>swag init
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;GinTest2/docs&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>swaggerFiles</span> <span class=s>&#34;github.com/swaggo/files&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>ginSwagger</span> <span class=s>&#34;github.com/swaggo/gin-swagger&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>login</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ctx</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;message&#34;</span><span class=p>:</span> <span class=s>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>submit</span><span class=p>(</span><span class=nx>ctx</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ctx</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;message&#34;</span><span class=p>:</span> <span class=s>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>//Default返回一个默认的路由引擎
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>router</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Simple group: v1
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>v1</span> <span class=o>:=</span> <span class=nx>router</span><span class=p>.</span><span class=nf>Group</span><span class=p>(</span><span class=s>&#34;/api/v1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>v1</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/login&#34;</span><span class=p>,</span> <span class=nx>login</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>v1</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/submit&#34;</span><span class=p>,</span> <span class=nx>submit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Simple group: v2
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>v2</span> <span class=o>:=</span> <span class=nx>router</span><span class=p>.</span><span class=nf>Group</span><span class=p>(</span><span class=s>&#34;/api/v2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>v2</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/login&#34;</span><span class=p>,</span> <span class=nx>login</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>v2</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/submit&#34;</span><span class=p>,</span> <span class=nx>submit</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>router</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/swagger/*any&#34;</span><span class=p>,</span> <span class=nx>ginSwagger</span><span class=p>.</span><span class=nf>WrapHandler</span><span class=p>(</span><span class=nx>swaggerFiles</span><span class=p>.</span><span class=nx>Handler</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=p>=</span> <span class=nx>router</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;:8080&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=访问接口文档>访问接口文档<a hidden class=anchor aria-hidden=true href=#访问接口文档>#</a></h4><pre tabindex=0><code>http://localhost:8080/swagger/index.html
</code></pre><h1 id=golang-使用sqlx连接mysql数据库>Golang 使用sqlx连接mysql数据库<a hidden class=anchor aria-hidden=true href=#golang-使用sqlx连接mysql数据库>#</a></h1><h2 id=安装三方包>安装三方包<a hidden class=anchor aria-hidden=true href=#安装三方包>#</a></h2><pre tabindex=0><code>go get github.com/go-sql-driver/mysql
go get github.com/jmoiron/sqlx
</code></pre><h2 id=maingo文件代码>main.go文件代码<a hidden class=anchor aria-hidden=true href=#maingo文件代码>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;github.com/go-sql-driver/mysql&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/jmoiron/sqlx&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>db</span> <span class=o>*</span><span class=nx>sqlx</span><span class=p>.</span><span class=nx>DB</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>user</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Id</span>       <span class=kt>int64</span>
</span></span><span class=line><span class=cl>	<span class=nx>UserName</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Pwd</span>      <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>initDB</span><span class=p>()</span> <span class=p>(</span><span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>dsn</span> <span class=o>:=</span> <span class=s>&#34;slbtraffic:1qaz#EDC@tcp(10.47.69.231:7306)/billing?charset=utf8mb4&amp;parseTime=True&#34;</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 也可以使用MustConnect连接不成功就panic
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>db</span><span class=p>,</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>sqlx</span><span class=p>.</span><span class=nf>Connect</span><span class=p>(</span><span class=s>&#34;mysql&#34;</span><span class=p>,</span> <span class=nx>dsn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;connect DB failed, err:%v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>db</span><span class=p>.</span><span class=nf>SetMaxOpenConns</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>db</span><span class=p>.</span><span class=nf>SetMaxIdleConns</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 查询单条数据示例
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>queryRowDemo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>sqlStr</span> <span class=o>:=</span> <span class=s>&#34;select id, username, pwd from users where id=?&#34;</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>u</span> <span class=nx>user</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>u</span><span class=p>,</span> <span class=nx>sqlStr</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;get failed, err:%v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;id:%d name:%s age:%d\n&#34;</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Id</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>UserName</span><span class=p>,</span> <span class=nx>u</span><span class=p>.</span><span class=nx>Pwd</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 查询多条数据示例
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>queryMultiRowDemo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>sqlStr</span> <span class=o>:=</span> <span class=s>&#34;select id, username, pwd from users&#34;</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>u</span> <span class=p>[]</span><span class=nx>user</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Select</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>u</span><span class=p>,</span> <span class=nx>sqlStr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;get multi row failed, err:%v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>val</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>u</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;id:%d name:%s pwd:%s\n&#34;</span><span class=p>,</span> <span class=nx>val</span><span class=p>.</span><span class=nx>Id</span><span class=p>,</span> <span class=nx>val</span><span class=p>.</span><span class=nx>UserName</span><span class=p>,</span> <span class=nx>val</span><span class=p>.</span><span class=nx>Pwd</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 插入数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>insertRowDemo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>sqlStr</span> <span class=o>:=</span> <span class=s>&#34;insert into users(username, pwd) values (?,?)&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>ret</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Exec</span><span class=p>(</span><span class=nx>sqlStr</span><span class=p>,</span> <span class=s>&#34;沙河小王子&#34;</span><span class=p>,</span> <span class=s>&#34;1235asd124142&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;insert failed, err:%v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>theID</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ret</span><span class=p>.</span><span class=nf>LastInsertId</span><span class=p>()</span> <span class=c1>// 新插入数据的id
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;get lastinsert ID failed, err:%v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;insert success, the id is %d.\n&#34;</span><span class=p>,</span> <span class=nx>theID</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 更新数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>updateRowDemo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>sqlStr</span> <span class=o>:=</span> <span class=s>&#34;update users set username=? where username=? limit 1&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>ret</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Exec</span><span class=p>(</span><span class=nx>sqlStr</span><span class=p>,</span> <span class=s>&#34;沙河小王子sb&#34;</span><span class=p>,</span> <span class=s>&#34;沙河小王子&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;upadte failed, err:%v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>n</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ret</span><span class=p>.</span><span class=nf>RowsAffected</span><span class=p>()</span> <span class=c1>// 操作影响的行数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;get RowsAffected failed, err:%v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;update success, RowsAffected is %d.\n&#34;</span><span class=p>,</span> <span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 删除数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>deleteRowDemo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>sqlStr</span> <span class=o>:=</span> <span class=s>&#34;delete from users where id = ?&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>ret</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>db</span><span class=p>.</span><span class=nf>Exec</span><span class=p>(</span><span class=nx>sqlStr</span><span class=p>,</span> <span class=mi>6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;delete failed, err:%v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>n</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ret</span><span class=p>.</span><span class=nf>RowsAffected</span><span class=p>()</span> <span class=c1>// 操作影响的行数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;get RowsAffected failed, err:%v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;delete success, affected rows:%d\n&#34;</span><span class=p>,</span> <span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>initDB</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nf>queryRowDemo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1>// insertRowDemo()
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nf>updateRowDemo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nf>deleteRowDemo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nf>queryMultiRowDemo</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=golang-gorm教程>Golang GORM教程<a hidden class=anchor aria-hidden=true href=#golang-gorm教程>#</a></h1><h2 id=安装和连接>安装和连接<a hidden class=anchor aria-hidden=true href=#安装和连接>#</a></h2><p>官方文档 <a href=https://gorm.io/zh_CN/docs/index.html>https://gorm.io/zh_CN/docs/index.html</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 创建项目</span>
</span></span><span class=line><span class=cl>go mod init 项目名称
</span></span><span class=line><span class=cl>go get -u gorm.io/gorm
</span></span><span class=line><span class=cl>go get -u gorm.io/driver/mysql
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;gorm.io/driver/mysql&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;gorm.io/gorm&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Product</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>gorm</span><span class=p>.</span><span class=nx>Model</span>
</span></span><span class=line><span class=cl>	<span class=nx>Code</span>  <span class=kt>string</span> <span class=s>`gorm:&#34;type:varchar(255)&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>Price</span> <span class=kt>uint</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>dsn</span> <span class=o>:=</span> <span class=s>&#34;slbtraffic:1qaz#EDC@tcp(10.47.69.231:7306)/billing?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>db</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>gorm</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=nx>mysql</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=nx>dsn</span><span class=p>),</span> <span class=o>&amp;</span><span class=nx>gorm</span><span class=p>.</span><span class=nx>Config</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=s>&#34;failed to connect database&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 迁移 schema
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// db.AutoMigrate(&amp;Product{})
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// // Create
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// db.Create(&amp;Product{Code: &#34;D43&#34;, Price: 120})
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// db.Create(&amp;Product{Code: &#34;D44&#34;, Price: 120})
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// db.Create(&amp;Product{Code: &#34;D45&#34;, Price: 120})
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// db.Create(&amp;Product{Code: &#34;D46&#34;, Price: 120})
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// 查询记录
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=kd>var</span> <span class=nx>productData</span> <span class=nx>Product</span>
</span></span><span class=line><span class=cl>	<span class=nx>db</span><span class=p>.</span><span class=nf>First</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>productData</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;productData=%v\n&#34;</span><span class=p>,</span> <span class=nx>productData</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// db.First(&amp;productData, &#34;code = ?&#34;, &#34;D46&#34;)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// fmt.Printf(&#34;productData=%#v\n&#34;, productData)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// 修改记录 将D46 修改为D666
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// db.Model(&amp;productData).Update(&#34;code&#34;, &#34;D666&#34;)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// Update - 更新多个字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// db.Model(&amp;productData).Updates(Product{Price: 200, Code: &#34;F42&#34;}) // 仅更新非零值字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// db.Model(&amp;productData).Updates(map[string]interface{}{&#34;Price&#34;: 200, &#34;Code&#34;: &#34;F42&#34;})
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// 删除
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// db.Delete(&amp;productData, 1)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=golang-操作redis--连接池>Golang 操作redis 连接池<a hidden class=anchor aria-hidden=true href=#golang-操作redis--连接池>#</a></h1><h2 id=安装redis连接库>安装redis连接库<a hidden class=anchor aria-hidden=true href=#安装redis连接库>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># 安装三方包</span>
</span></span><span class=line><span class=cl>go get github.com/go-redis/redis/v8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 插件官方</span>
</span></span><span class=line><span class=cl>https://github.com/go-redis/redis
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 官方文档</span>
</span></span><span class=line><span class=cl>https://redis.uptrace.dev/guide/go-redis.html#installation
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/go-redis/redis/v8&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>ctx</span> <span class=p>=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>rdb</span> <span class=o>:=</span> <span class=nx>redis</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>redis</span><span class=p>.</span><span class=nx>Options</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Addr</span><span class=p>:</span>     <span class=s>&#34;10.43.152.50:10001&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Password</span><span class=p>:</span> <span class=s>&#34;f1543f7c&#34;</span><span class=p>,</span> <span class=c1>// 密码
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>DB</span><span class=p>:</span>       <span class=mi>1</span><span class=p>,</span>          <span class=c1>// 数据库
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>PoolSize</span><span class=p>:</span> <span class=mi>20</span><span class=p>,</span>         <span class=c1>// 连接池大小
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>pong</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rdb</span><span class=p>.</span><span class=nf>Ping</span><span class=p>(</span><span class=nx>ctx</span><span class=p>).</span><span class=nf>Result</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>pong</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>	<span class=c1>// 直接执行命令获取错误
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>err</span> <span class=p>=</span> <span class=nx>rdb</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;key&#34;</span><span class=p>,</span> <span class=mi>520</span><span class=p>,</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Hour</span><span class=p>).</span><span class=nf>Err</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 直接执行命令获取值
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>value</span> <span class=o>:=</span> <span class=nx>rdb</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=s>&#34;key&#34;</span><span class=p>).</span><span class=nf>Val</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=gin-框架-jwt的实现重要>Gin 框架 JWT的实现（重要）<a hidden class=anchor aria-hidden=true href=#gin-框架-jwt的实现重要>#</a></h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;strings&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/golang-jwt/jwt/v4&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// jwt 过期时间
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>const</span> <span class=nx>TokenExpireDuration</span> <span class=p>=</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Hour</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// CustomSecret 用于加盐的字符串
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>CustomSecret</span> <span class=p>=</span> <span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;夏天夏天悄悄过去&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>UserInfo</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Username</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Password</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>CustomClaims</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 可根据需要自行添加字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Username</span>             <span class=kt>string</span> <span class=s>`json:&#34;username&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>jwt</span><span class=p>.</span><span class=nx>RegisteredClaims</span>        <span class=c1>// 内嵌标准的声明
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// GenToken 生成JWT
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>GenToken</span><span class=p>(</span><span class=nx>username</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=kt>string</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 创建一个我们自己的声明
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>claims</span> <span class=o>:=</span> <span class=nx>CustomClaims</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>username</span><span class=p>,</span> <span class=c1>// 自定义字段
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>jwt</span><span class=p>.</span><span class=nx>RegisteredClaims</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>ExpiresAt</span><span class=p>:</span> <span class=nx>jwt</span><span class=p>.</span><span class=nf>NewNumericDate</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>Add</span><span class=p>(</span><span class=nx>TokenExpireDuration</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>			<span class=nx>Issuer</span><span class=p>:</span>    <span class=s>&#34;my-project&#34;</span><span class=p>,</span> <span class=c1>// 签发人
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 使用指定的签名方法创建签名对象
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>token</span> <span class=o>:=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nf>NewWithClaims</span><span class=p>(</span><span class=nx>jwt</span><span class=p>.</span><span class=nx>SigningMethodHS256</span><span class=p>,</span> <span class=nx>claims</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 使用指定的secret签名并获得完整的编码后的字符串token
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=nx>token</span><span class=p>.</span><span class=nf>SignedString</span><span class=p>(</span><span class=nx>CustomSecret</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>authHandler</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 用户发送用户名和密码过来
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=kd>var</span> <span class=nx>user</span> <span class=nx>UserInfo</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>ShouldBind</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2001</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;无效的参数&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 校验用户名和密码是否正确
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>user</span><span class=p>.</span><span class=nx>Username</span> <span class=o>==</span> <span class=s>&#34;q1mi&#34;</span> <span class=o>&amp;&amp;</span> <span class=nx>user</span><span class=p>.</span><span class=nx>Password</span> <span class=o>==</span> <span class=s>&#34;q1mi123&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 生成Token
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>tokenString</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nf>GenToken</span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>Username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;data&#34;</span><span class=p>:</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;token&#34;</span><span class=p>:</span> <span class=nx>tokenString</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2002</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;鉴权失败&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ParseToken 解析JWT
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>ParseToken</span><span class=p>(</span><span class=nx>tokenString</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>CustomClaims</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 解析token
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 如果是自定义Claim结构体则需要使用 ParseWithClaims 方法
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>token</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nf>ParseWithClaims</span><span class=p>(</span><span class=nx>tokenString</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>CustomClaims</span><span class=p>{},</span> <span class=kd>func</span><span class=p>(</span><span class=nx>token</span> <span class=o>*</span><span class=nx>jwt</span><span class=p>.</span><span class=nx>Token</span><span class=p>)</span> <span class=p>(</span><span class=nx>i</span> <span class=kd>interface</span><span class=p>{},</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 直接使用标准的Claim则可以直接使用Parse方法
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>//token, err := jwt.Parse(tokenString, func(token *jwt.Token) (i interface{}, err error) {
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>return</span> <span class=nx>CustomSecret</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 对token对象中的Claim进行类型断言
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>claims</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>token</span><span class=p>.</span><span class=nx>Claims</span><span class=p>.(</span><span class=o>*</span><span class=nx>CustomClaims</span><span class=p>);</span> <span class=nx>ok</span> <span class=o>&amp;&amp;</span> <span class=nx>token</span><span class=p>.</span><span class=nx>Valid</span> <span class=p>{</span> <span class=c1>// 校验token
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>return</span> <span class=nx>claims</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;invalid token&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// JWTAuthMiddleware 基于JWT的认证中间件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>JWTAuthMiddleware</span><span class=p>()</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 客户端携带Token有三种方式 1.放在请求头 2.放在请求体 3.放在URI
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// 这里假设Token放在Header的Authorization中，并使用Bearer开头
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// 这里的具体实现方式要依据你的实际业务情况决定
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>authHeader</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;Authorization&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>authHeader</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2003</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;请求头中auth为空&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>Abort</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 按空格分割
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>parts</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>SplitN</span><span class=p>(</span><span class=nx>authHeader</span><span class=p>,</span> <span class=s>&#34; &#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>!(</span><span class=nb>len</span><span class=p>(</span><span class=nx>parts</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span> <span class=o>&amp;&amp;</span> <span class=nx>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s>&#34;Bearer&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2004</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;请求头中auth格式有误&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>Abort</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>// parts[1]是获取到的tokenString，我们使用之前定义好的解析JWT的函数来解析它
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>mc</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>ParseToken</span><span class=p>(</span><span class=nx>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2005</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;无效的Token&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>Abort</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 将当前请求的username信息保存到请求的上下文c上
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>c</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>,</span> <span class=nx>mc</span><span class=p>.</span><span class=nx>Username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>c</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span> <span class=c1>// 后续的处理函数可以用过c.Get(&#34;username&#34;)来获取当前请求的用户信息
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>homeHandler</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>username</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>MustGet</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>).(</span><span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;data&#34;</span><span class=p>:</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;username&#34;</span><span class=p>:</span> <span class=nx>username</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/auth&#34;</span><span class=p>,</span> <span class=nx>authHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/home&#34;</span><span class=p>,</span> <span class=nf>JWTAuthMiddleware</span><span class=p>(),</span> <span class=nx>homeHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=swagger接口文档>swagger接口文档<a hidden class=anchor aria-hidden=true href=#swagger接口文档>#</a></h1><h2 id=用法步骤>用法步骤<a hidden class=anchor aria-hidden=true href=#用法步骤>#</a></h2><ol><li>按照swagger要求给接口代码添加声明式注释，具体参照<a href=https://swaggo.github.io/swaggo.io/declarative_comments_format/>声明式注释格式</a>。</li><li>使用swag工具扫描代码自动生成API接口文档数据</li><li>使用gin-swagger渲染在线接口文档页面</li></ol><h2 id=安装swag工具在注释编写完成后使用>安装swag工具，在注释编写完成后使用<a hidden class=anchor aria-hidden=true href=#安装swag工具在注释编写完成后使用>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>go get -u github.com/swaggo/swag/cmd/swag
</span></span><span class=line><span class=cl>swag init  <span class=c1># 会生成docs目录</span>
</span></span><span class=line><span class=cl><span class=c1>#./docs</span>
</span></span><span class=line><span class=cl><span class=c1>#├── docs.go</span>
</span></span><span class=line><span class=cl><span class=c1>#├── swagger.json</span>
</span></span><span class=line><span class=cl><span class=c1>#└── swagger.yaml</span>
</span></span></code></pre></div><h2 id=引入gin-swagger>引入gin-swagger<a hidden class=anchor aria-hidden=true href=#引入gin-swagger>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;GinJwt/docs&#34;</span> <span class=c1>// 千万不要忘了导入把你上一步生成的docs
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>swaggerFiles</span> <span class=s>&#34;github.com/swaggo/files&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>gs</span> <span class=s>&#34;github.com/swaggo/gin-swagger&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><h3 id=下载三方包>下载三方包<a hidden class=anchor aria-hidden=true href=#下载三方包>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>go</span> <span class=nx>get</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>swaggo</span><span class=o>/</span><span class=nx>gin</span><span class=o>-</span><span class=nx>swagger</span>
</span></span><span class=line><span class=cl><span class=k>go</span> <span class=nx>get</span> <span class=nx>github</span><span class=p>.</span><span class=nx>com</span><span class=o>/</span><span class=nx>swaggo</span><span class=o>/</span><span class=nx>files</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;strings&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>_</span> <span class=s>&#34;GinJwt/docs&#34;</span> <span class=c1>// 千万不要忘了导入把你上一步生成的docs
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/golang-jwt/jwt/v4&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>swaggerFiles</span> <span class=s>&#34;github.com/swaggo/files&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nx>gs</span> <span class=s>&#34;github.com/swaggo/gin-swagger&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// jwt 过期时间
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>const</span> <span class=nx>TokenExpireDuration</span> <span class=p>=</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Hour</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// CustomSecret 用于加盐的字符串
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>CustomSecret</span> <span class=p>=</span> <span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;夏天夏天悄悄过去&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>UserInfo</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Username</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Password</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>CustomClaims</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 可根据需要自行添加字段
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>Username</span>             <span class=kt>string</span> <span class=s>`json:&#34;username&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=nx>jwt</span><span class=p>.</span><span class=nx>RegisteredClaims</span>        <span class=c1>// 内嵌标准的声明
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// GenToken 生成JWT
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>GenToken</span><span class=p>(</span><span class=nx>username</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=kt>string</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 创建一个我们自己的声明
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>claims</span> <span class=o>:=</span> <span class=nx>CustomClaims</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>username</span><span class=p>,</span> <span class=c1>// 自定义字段
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>jwt</span><span class=p>.</span><span class=nx>RegisteredClaims</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>ExpiresAt</span><span class=p>:</span> <span class=nx>jwt</span><span class=p>.</span><span class=nf>NewNumericDate</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>Add</span><span class=p>(</span><span class=nx>TokenExpireDuration</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>			<span class=nx>Issuer</span><span class=p>:</span>    <span class=s>&#34;my-project&#34;</span><span class=p>,</span> <span class=c1>// 签发人
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 使用指定的签名方法创建签名对象
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>token</span> <span class=o>:=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nf>NewWithClaims</span><span class=p>(</span><span class=nx>jwt</span><span class=p>.</span><span class=nx>SigningMethodHS256</span><span class=p>,</span> <span class=nx>claims</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 使用指定的secret签名并获得完整的编码后的字符串token
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=nx>token</span><span class=p>.</span><span class=nf>SignedString</span><span class=p>(</span><span class=nx>CustomSecret</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>authHandler</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 用户发送用户名和密码过来
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=kd>var</span> <span class=nx>user</span> <span class=nx>UserInfo</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>ShouldBind</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2001</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;无效的参数&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 校验用户名和密码是否正确
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>user</span><span class=p>.</span><span class=nx>Username</span> <span class=o>==</span> <span class=s>&#34;q1mi&#34;</span> <span class=o>&amp;&amp;</span> <span class=nx>user</span><span class=p>.</span><span class=nx>Password</span> <span class=o>==</span> <span class=s>&#34;q1mi123&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 生成Token
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>tokenString</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nf>GenToken</span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nx>Username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;data&#34;</span><span class=p>:</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;token&#34;</span><span class=p>:</span> <span class=nx>tokenString</span><span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2002</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;鉴权失败&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ParseToken 解析JWT
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>ParseToken</span><span class=p>(</span><span class=nx>tokenString</span> <span class=kt>string</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>CustomClaims</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 解析token
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 如果是自定义Claim结构体则需要使用 ParseWithClaims 方法
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>token</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>jwt</span><span class=p>.</span><span class=nf>ParseWithClaims</span><span class=p>(</span><span class=nx>tokenString</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>CustomClaims</span><span class=p>{},</span> <span class=kd>func</span><span class=p>(</span><span class=nx>token</span> <span class=o>*</span><span class=nx>jwt</span><span class=p>.</span><span class=nx>Token</span><span class=p>)</span> <span class=p>(</span><span class=nx>i</span> <span class=kd>interface</span><span class=p>{},</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 直接使用标准的Claim则可以直接使用Parse方法
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>//token, err := jwt.Parse(tokenString, func(token *jwt.Token) (i interface{}, err error) {
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>return</span> <span class=nx>CustomSecret</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 对token对象中的Claim进行类型断言
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>claims</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>token</span><span class=p>.</span><span class=nx>Claims</span><span class=p>.(</span><span class=o>*</span><span class=nx>CustomClaims</span><span class=p>);</span> <span class=nx>ok</span> <span class=o>&amp;&amp;</span> <span class=nx>token</span><span class=p>.</span><span class=nx>Valid</span> <span class=p>{</span> <span class=c1>// 校验token
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>return</span> <span class=nx>claims</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;invalid token&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// JWTAuthMiddleware 基于JWT的认证中间件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>JWTAuthMiddleware</span><span class=p>()</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 客户端携带Token有三种方式 1.放在请求头 2.放在请求体 3.放在URI
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// 这里假设Token放在Header的Authorization中，并使用Bearer开头
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// 这里的具体实现方式要依据你的实际业务情况决定
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>authHeader</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;Authorization&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>authHeader</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2003</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;请求头中auth为空&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>Abort</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 按空格分割
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>parts</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>SplitN</span><span class=p>(</span><span class=nx>authHeader</span><span class=p>,</span> <span class=s>&#34; &#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>!(</span><span class=nb>len</span><span class=p>(</span><span class=nx>parts</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span> <span class=o>&amp;&amp;</span> <span class=nx>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s>&#34;Bearer&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2004</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;请求头中auth格式有误&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>Abort</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>// parts[1]是获取到的tokenString，我们使用之前定义好的解析JWT的函数来解析它
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>mc</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>ParseToken</span><span class=p>(</span><span class=nx>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2005</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;无效的Token&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>Abort</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>// 将当前请求的username信息保存到请求的上下文c上
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>c</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>,</span> <span class=nx>mc</span><span class=p>.</span><span class=nx>Username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>c</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span> <span class=c1>// 后续的处理函数可以用过c.Get(&#34;username&#34;)来获取当前请求的用户信息
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// homeHandler 测试jwt功能接口
</span></span></span><span class=line><span class=cl><span class=c1>// @Summary 测试jwt功能接口
</span></span></span><span class=line><span class=cl><span class=c1>// @Description 测试jwt功能接口
</span></span></span><span class=line><span class=cl><span class=c1>// @Tags 测试jwt功能接口
</span></span></span><span class=line><span class=cl><span class=c1>// @Accept application/json
</span></span></span><span class=line><span class=cl><span class=c1>// @Produce application/json
</span></span></span><span class=line><span class=cl><span class=c1>// @Param Authorization header string false &#34;Bearer 用户令牌&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// @Security ApiKeyAuth
</span></span></span><span class=line><span class=cl><span class=c1>// @Success 200
</span></span></span><span class=line><span class=cl><span class=c1>// @Router /home [get] {&#34;username&#34;: username}
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>homeHandler</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>username</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>MustGet</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>).(</span><span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>2000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;msg&#34;</span><span class=p>:</span>  <span class=s>&#34;success&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;data&#34;</span><span class=p>:</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span><span class=s>&#34;username&#34;</span><span class=p>:</span> <span class=nx>username</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/auth&#34;</span><span class=p>,</span> <span class=nx>authHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/home&#34;</span><span class=p>,</span> <span class=nf>JWTAuthMiddleware</span><span class=p>(),</span> <span class=nx>homeHandler</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/swagger/*any&#34;</span><span class=p>,</span> <span class=nx>gs</span><span class=p>.</span><span class=nf>WrapHandler</span><span class=p>(</span><span class=nx>swaggerFiles</span><span class=p>.</span><span class=nx>Handler</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=访问地址>访问地址<a hidden class=anchor aria-hidden=true href=#访问地址>#</a></h3><p>http://localhost:8080/swagger/index.html</p><h1 id=golang三方库>Golang三方库<a hidden class=anchor aria-hidden=true href=#golang三方库>#</a></h1><h2 id=gopsutil>gopsutil<a hidden class=anchor aria-hidden=true href=#gopsutil>#</a></h2><p><code>psutil</code>是一个跨平台进程和系统监控的Python库，而<code>gopsutil</code>是其Go语言版本的实现。本文介绍了它的基本使用。</p><p>Go语言部署简单、性能好的特点非常适合做一些诸如采集系统信息和监控的服务，本文介绍的<a href=https://github.com/shirou/gopsutil>gopsutil</a>库是知名Python库：<a href=https://github.com/giampaolo/psutil>psutil</a>的一个Go语言版本的实现。</p><h3 id=安装>安装<a hidden class=anchor aria-hidden=true href=#安装>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go get github.com/shirou/gopsutil
</span></span></code></pre></div><p>windows额外安装</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>go get github.com/yusufpapurcu/wmi
</span></span><span class=line><span class=cl>go get golang.org/x/sys/windows
</span></span></code></pre></div><h3 id=使用>使用<a hidden class=anchor aria-hidden=true href=#使用>#</a></h3><h4 id=采集cpu相关信息>采集CPU相关信息<a hidden class=anchor aria-hidden=true href=#采集cpu相关信息>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/shirou/gopsutil/cpu&#34;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/shirou/gopsutil/load&#34;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/shirou/gopsutil/mem&#34;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/shirou/gopsutil/host&#34;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/shirou/gopsutil/disk&#34;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;github.com/shirou/gopsutil/net&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// cpu info
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>getCpuInfo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>cpuInfos</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>cpu</span><span class=p>.</span><span class=nf>Info</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;get cpu info failed, err:%v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>ci</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>cpuInfos</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>ci</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=c1>// CPU使用率
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>percent</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>cpu</span><span class=p>.</span><span class=nf>Percent</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span><span class=p>,</span> <span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;cpu percent:%v\n&#34;</span><span class=p>,</span> <span class=nx>percent</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>getCpuLoad</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>info</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>load</span><span class=p>.</span><span class=nf>Avg</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%v\n&#34;</span><span class=p>,</span> <span class=nx>info</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// mem info
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>getMemInfo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>memInfo</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>mem</span><span class=p>.</span><span class=nf>VirtualMemory</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;mem info:%v\n&#34;</span><span class=p>,</span> <span class=nx>memInfo</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// host info
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>getHostInfo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>hInfo</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>host</span><span class=p>.</span><span class=nf>Info</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;host info:%v uptime:%v boottime:%v\n&#34;</span><span class=p>,</span> <span class=nx>hInfo</span><span class=p>,</span> <span class=nx>hInfo</span><span class=p>.</span><span class=nx>Uptime</span><span class=p>,</span> <span class=nx>hInfo</span><span class=p>.</span><span class=nx>BootTime</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// disk info
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>getDiskInfo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>parts</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>disk</span><span class=p>.</span><span class=nf>Partitions</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;get Partitions failed, err:%v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>part</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>parts</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;part:%v\n&#34;</span><span class=p>,</span> <span class=nx>part</span><span class=p>.</span><span class=nf>String</span><span class=p>())</span>
</span></span><span class=line><span class=cl>		<span class=nx>diskInfo</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>disk</span><span class=p>.</span><span class=nf>Usage</span><span class=p>(</span><span class=nx>part</span><span class=p>.</span><span class=nx>Mountpoint</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;disk info:used:%v free:%v\n&#34;</span><span class=p>,</span> <span class=nx>diskInfo</span><span class=p>.</span><span class=nx>UsedPercent</span><span class=p>,</span> <span class=nx>diskInfo</span><span class=p>.</span><span class=nx>Free</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>ioStat</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>disk</span><span class=p>.</span><span class=nf>IOCounters</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>k</span><span class=p>,</span> <span class=nx>v</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>ioStat</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%v:%v\n&#34;</span><span class=p>,</span> <span class=nx>k</span><span class=p>,</span> <span class=nx>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// net IO
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>getNetInfo</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>info</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>net</span><span class=p>.</span><span class=nf>IOCounters</span><span class=p>(</span><span class=kc>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>index</span><span class=p>,</span> <span class=nx>v</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>info</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%v:%v send:%v recv:%v\n&#34;</span><span class=p>,</span> <span class=nx>index</span><span class=p>,</span> <span class=nx>v</span><span class=p>,</span> <span class=nx>v</span><span class=p>.</span><span class=nx>BytesSent</span><span class=p>,</span> <span class=nx>v</span><span class=p>.</span><span class=nx>BytesRecv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// get ip
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>GetLocalIP</span><span class=p>()</span> <span class=p>(</span><span class=nx>ip</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>addrs</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>net</span><span class=p>.</span><span class=nf>InterfaceAddrs</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>addr</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>addrs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ipAddr</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>addr</span><span class=p>.(</span><span class=o>*</span><span class=nx>net</span><span class=p>.</span><span class=nx>IPNet</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>continue</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>ipAddr</span><span class=p>.</span><span class=nx>IP</span><span class=p>.</span><span class=nf>IsLoopback</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>continue</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=p>!</span><span class=nx>ipAddr</span><span class=p>.</span><span class=nx>IP</span><span class=p>.</span><span class=nf>IsGlobalUnicast</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>continue</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>ipAddr</span><span class=p>.</span><span class=nx>IP</span><span class=p>.</span><span class=nf>String</span><span class=p>(),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=适用工具上传下载文件>适用工具，上传下载文件<a hidden class=anchor aria-hidden=true href=#适用工具上传下载文件>#</a></h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;flag&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/gin-gonic/gin&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;io/ioutil&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>FileDir</span> <span class=p>=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;d&#34;</span><span class=p>,</span> <span class=s>&#34;D:\\golang_project\\src\\uploadDownload\\file_dir&#34;</span><span class=p>,</span> <span class=s>`-d 绝对路径 指定上传和下载的目录`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>Port</span> <span class=p>=</span> <span class=nx>flag</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=s>&#34;p&#34;</span><span class=p>,</span> <span class=mi>8080</span><span class=p>,</span><span class=s>`-p 监听端口号 指定程序运行端口号`</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>flag</span><span class=p>.</span><span class=nf>Parse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>router</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 处理multipart forms提交文件时默认的内存限制是32 MiB
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 可以通过下面的方式修改
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// router.MaxMultipartMemory = 8 &lt;&lt; 20  // 8 MiB
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>router</span><span class=p>.</span><span class=nf>POST</span><span class=p>(</span><span class=s>&#34;/upload&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Multipart form
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>form</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>MultipartForm</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=nx>files</span> <span class=o>:=</span> <span class=nx>form</span><span class=p>.</span><span class=nx>File</span><span class=p>[</span><span class=s>&#34;file&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>file</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>files</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>file</span><span class=p>.</span><span class=nx>Filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>dst</span> <span class=o>:=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%s/%s&#34;</span><span class=p>,</span> <span class=o>*</span><span class=nx>FileDir</span><span class=p>,</span> <span class=nx>file</span><span class=p>.</span><span class=nx>Filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>dst</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=c1>// 上传文件到指定的目录
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=nx>c</span><span class=p>.</span><span class=nf>SaveUploadedFile</span><span class=p>(</span><span class=nx>file</span><span class=p>,</span> <span class=nx>dst</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=s>&#34;message&#34;</span><span class=p>:</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%d files uploaded!&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>files</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>router</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/listfile&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fileInfoList</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ioutil</span><span class=p>.</span><span class=nf>ReadDir</span><span class=p>(</span><span class=o>*</span><span class=nx>FileDir</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=nx>FileList</span> <span class=p>[]</span><span class=kt>string</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>fileInfoList</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>FileList</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>FileList</span><span class=p>,</span><span class=nx>fileInfoList</span><span class=p>[</span><span class=nx>i</span><span class=p>].</span><span class=nf>Name</span><span class=p>())</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;msg&#34;</span><span class=p>:</span> <span class=s>&#34;Error&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>c</span><span class=p>.</span><span class=nf>JSON</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>,</span> <span class=nx>gin</span><span class=p>.</span><span class=nx>H</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;code&#34;</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=s>&#34;file_list&#34;</span><span class=p>:</span> <span class=nx>FileList</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=p>})</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=nx>router</span><span class=p>.</span><span class=nf>GET</span><span class=p>(</span><span class=s>&#34;/download/:file&#34;</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>c</span> <span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>filename</span> <span class=o>:=</span> <span class=nx>c</span><span class=p>.</span><span class=nf>Param</span><span class=p>(</span><span class=s>&#34;file&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>filepath</span> <span class=o>:=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%s/%s&#34;</span><span class=p>,</span> <span class=o>*</span><span class=nx>FileDir</span><span class=p>,</span> <span class=nx>filename</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>c</span><span class=p>.</span><span class=nf>File</span><span class=p>(</span><span class=nx>filepath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>port</span> <span class=o>:=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;:%d&#34;</span><span class=p>,</span><span class=o>*</span><span class=nx>Port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>router</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=常用函数>常用函数<a hidden class=anchor aria-hidden=true href=#常用函数>#</a></h1><h2 id=时间和日期相关函数>时间和日期相关函数<a hidden class=anchor aria-hidden=true href=#时间和日期相关函数>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 日期和时间相关的函数
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>now</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%v \n&#34;</span><span class=p>,</span> <span class=nx>now</span><span class=p>)</span> <span class=c1>//2022-08-16 17:08:36.0952186 +0800 CST m=+0.007682101
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>	<span class=c1>// 获取时间其他相关信息
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;%v-%v-%v %v:%v:%v\n&#34;</span><span class=p>,</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Year</span><span class=p>(),</span> <span class=nb>int</span><span class=p>(</span><span class=nx>now</span><span class=p>.</span><span class=nf>Month</span><span class=p>()),</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Day</span><span class=p>(),</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Hour</span><span class=p>(),</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Minute</span><span class=p>(),</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Second</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 格式化日期和时间
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 1、printf
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmtTime</span> <span class=o>:=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%v-%v-%v %v:%v:%v&#34;</span><span class=p>,</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Year</span><span class=p>(),</span> <span class=nb>int</span><span class=p>(</span><span class=nx>now</span><span class=p>.</span><span class=nf>Month</span><span class=p>()),</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Day</span><span class=p>(),</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Hour</span><span class=p>(),</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Minute</span><span class=p>(),</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Second</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>fmtTime</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 2、使用官方的format函数 (推荐)
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>Format</span><span class=p>(</span><span class=s>&#34;2006-01-02 15:04:05&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nf>Now</span><span class=p>().</span><span class=nf>Format</span><span class=p>(</span><span class=s>&#34;01-02&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=c1>//时间 to 时间戳
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=nx>loc</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>LoadLocation</span><span class=p>(</span><span class=s>&#34;Asia/Shanghai&#34;</span><span class=p>)</span>        <span class=c1>//设置时区
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=nx>tt</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>ParseInLocation</span><span class=p>(</span><span class=s>&#34;2006-01-02 15:04:05&#34;</span><span class=p>,</span> <span class=s>&#34;2018-07-11 15:07:51&#34;</span><span class=p>,</span> <span class=nx>loc</span><span class=p>)</span> <span class=c1>//2006-01-02 15:04:05是转换的格式如php的&#34;Y-m-d H:i:s&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>   <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nf>Unix</span><span class=p>())</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 时间常量
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=kd>const</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=nx>ns</span> <span class=p>=</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Nanosecond</span>
</span></span><span class=line><span class=cl>		<span class=nx>us</span> <span class=p>=</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Microsecond</span>
</span></span><span class=line><span class=cl>		<span class=nx>ms</span> <span class=p>=</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span>
</span></span><span class=line><span class=cl>		<span class=nx>ss</span> <span class=p>=</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Second</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 时间戳 Unix UnixNano 纳秒 获取随机数字
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;unix时间戳=%v unixnano时间戳=%v\n&#34;</span><span class=p>,</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Unix</span><span class=p>(),</span> <span class=nx>now</span><span class=p>.</span><span class=nf>UnixNano</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 时间戳转日期
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>needConvertUnix</span> <span class=o>:=</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Unix</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>needConvertUnixTime</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>Unix</span><span class=p>(</span><span class=nx>needConvertUnix</span><span class=p>,</span> <span class=mi>0</span><span class=p>).</span><span class=nf>Format</span><span class=p>(</span><span class=s>&#34;2006-01-02 15:04:05&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;时间戳:%v is %v\n&#34;</span><span class=p>,</span> <span class=nx>needConvertUnix</span><span class=p>,</span> <span class=nx>needConvertUnixTime</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// 时间加减
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 一天前的时间
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>oneDayBefore</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>ParseDuration</span><span class=p>(</span><span class=s>&#34;-24h&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>d1</span> <span class=o>:=</span> <span class=nx>now</span><span class=p>.</span><span class=nf>Add</span><span class=p>(</span><span class=nx>oneDayBefore</span><span class=p>).</span><span class=nf>Format</span><span class=p>(</span><span class=s>&#34;2006-01-02 15:04:05&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;昨天的日期：%v \n&#34;</span><span class=p>,</span> <span class=nx>d1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>d2</span> <span class=o>:=</span> <span class=nx>now</span><span class=p>.</span><span class=nf>AddDate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>).</span><span class=nf>Format</span><span class=p>(</span><span class=s>&#34;2006-01-02 15:04:05&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;上月的日期：%v&#34;</span><span class=p>,</span> <span class=nx>d2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=os标准库>os标准库<a hidden class=anchor aria-hidden=true href=#os标准库>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// 遍历所有环境遍历
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>envs</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Environ</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>value</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>envs</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>cache</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Split</span><span class=p>(</span><span class=nx>value</span><span class=p>,</span> <span class=s>&#34;=&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>cache</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取指定名称的环境变量
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>golandEnv</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;GoLand&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;golandEnv is %s\n&#34;</span><span class=p>,</span> <span class=nx>golandEnv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 打印主机名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nf>Hostname</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取当前路径
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>filePath</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getwd</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>filePath</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=bytes标准库>bytes标准库<a hidden class=anchor aria-hidden=true href=#bytes标准库>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestConvertAb</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>b</span> <span class=p>=</span> <span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;abcaBSADASD12-2131&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 转大写
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>upper</span> <span class=o>:=</span> <span class=nx>bytes</span><span class=p>.</span><span class=nf>ToUpper</span><span class=p>(</span><span class=nx>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 转小写
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>lower</span> <span class=o>:=</span> <span class=nx>bytes</span><span class=p>.</span><span class=nf>ToLower</span><span class=p>(</span><span class=nx>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nb>string</span><span class=p>(</span><span class=nx>b</span><span class=p>),</span> <span class=nb>string</span><span class=p>(</span><span class=nx>upper</span><span class=p>),</span> <span class=nb>string</span><span class=p>(</span><span class=nx>lower</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>c</span> <span class=p>=</span> <span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;ABC&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>d</span> <span class=p>=</span> <span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=s>&#34;ABc&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=c1>// 忽略大小写比较
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nx>bytes</span><span class=p>.</span><span class=nf>EqualFold</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span> <span class=nx>d</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;c:%v,d:%v c=d成立\n&#34;</span><span class=p>,</span> <span class=nx>c</span><span class=p>,</span> <span class=nx>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://wandong.notewan.com/tags/go/>go</a></li></ul><nav class=paginav><a class=prev href=https://wandong.notewan.com/post/helm%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/><span class=title>« Prev Page</span><br><span>helm的使用方法介绍</span></a>
<a class=next href=https://wandong.notewan.com/post/golang%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%B3%BB%E7%BB%9F/><span class=title>Next Page »</span><br><span>golang定时任务系统</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Golang学习笔记 on twitter" href="https://twitter.com/intent/tweet/?text=Golang%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0&url=https%3a%2f%2fwandong.notewan.com%2fpost%2fgolang%2f&hashtags=go"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang学习笔记 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwandong.notewan.com%2fpost%2fgolang%2f&title=Golang%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0&summary=Golang%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0&source=https%3a%2f%2fwandong.notewan.com%2fpost%2fgolang%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang学习笔记 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwandong.notewan.com%2fpost%2fgolang%2f&title=Golang%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang学习笔记 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwandong.notewan.com%2fpost%2fgolang%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang学习笔记 on whatsapp" href="https://api.whatsapp.com/send?text=Golang%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0%20-%20https%3a%2f%2fwandong.notewan.com%2fpost%2fgolang%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang学习笔记 on telegram" href="https://telegram.me/share/url?text=Golang%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0&url=https%3a%2f%2fwandong.notewan.com%2fpost%2fgolang%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://wandong.notewan.com>万东的云计算运维博客</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>